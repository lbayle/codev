<div id="content">

<style type="text/css">
  ul.dynatree-container span.td {
     position: absolute;
     display: inline;
     border-size: 1px;
     overflow: hidden;
     background-color: white;
  }
  ul.dynatree-container span.td:nth-child(1) {
     position: static;
  }
  ul.dynatree-container span.td:nth-child(2) {
     left: 300px;
     width: 130px;
  }
  ul.dynatree-container span.td:nth-child(3) {
     left: 430px;
     width: 130px;
  }
  </style>

  <script src="js/progress.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(function(){
      $("#tree").dynatree({
        // using default options
      });

      $("#tree2").dynatree({
            onCustomRender: function(node) {
            // Render title as columns
            if(node.data.title.indexOf("~") === -1){
              // Default rendering
              return false;
            }
            var cols = node.data.title.split("~"),
            html = "<a class='dynatree-title' href='#'>";
            for(var i=0; i<cols.length; i++){
               html += "<span class='td'>" + cols[i] + "</span>";
            }
            return html + "</a>";
          }
      });
      
    });
  </script>

   <h1>WBS Edit</h1>
  <a id="bt_saveTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_save.png" style="vertical-align: middle;" title="{t}Save{/t}"> Save</a>

  <div id="tree">
    <ul id="treeData" style="display: none;">
      <li id="m1600">1600 a mantis task
      <li id="m1632">1632 another mantis task
      <li id="wbse1" class="folder expanded">WBS
        <ul>
          <li id="m1655">1655 check dynatree library
          <li id="m1656">1656 define WbsElement class
          <li id="m1657">1657 define WbsElement in DB
        </ul>
      <li id="wbse2" class="folder expanded">Dashboard
        <ul>
          <li id="wbse3"  class="folder">Dashboard Homepage
            <ul>
              <li id="m1700">1700 add dashboard
              <li id="m1701">1701 add basic indicators
            </ul>
          <li id="wbse4" class="folder">Dashboard Items
            <ul>
              <li id="m1702">1702 convert all indicators to dashboard items
              <li id="m1703">1703 include filters in dashboard items
            </ul>
        </ul>
    </ul>
  </div>


   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_saveTree").click(function(event) {
            event.preventDefault();

            var dict = $("#tree").dynatree("getTree").toDict();
            var jsonDict = JSON.stringify(dict);
            var formSaveWBS = jQuery("#formSaveWBS");
            formSaveWBS.find("input[name=jsonDynatreeDict]").val(jsonDict);

            jQuery.ajax({
               type: "GET",
               url: formSaveWBS.attr("action"),
               data: formSaveWBS.serialize(),
               success: function(data) {
                  alert("WBS Saved: " + data);
               },
               error:  function(data) {
                  alert("WBS Save ERROR: " + data);
               }
            });
         });

      });
   </script>

   <form id="formSaveWBS" method="get" action="tests/dynatree_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="saveWBS" />
         <input type="hidden" name="jsonDynatreeDict" value="" />
      </fieldset>
   </form>


   <h1>WBS Display</h1>

   <a id="bt_loadTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_refresh.png" style="vertical-align: middle;" title="{t}Load{/t}"> Load</a>
  
   <div id="tree2">
     <ul id="treeData2" style="display: none;">
       <li id="1600">1600 a mantis task~<div class="progress">10%</div>~col2
       <li id="1632">1632 another mantis task~<div class="progress">15%</div>
       <li id="bse1" class="folder expanded">WBS~<div class="progress">20%</div>~col2
         <ul>
           <li id="1655">1655 check dynatree library~<div class="progress">25%</div>~col2
           <li id="1656">1656 define WbsElement class~<div class="progress">30%</div>~col2
           <li id="1657">1657 define WbsElement in DB~<div class="progress">35%</div>~col2
         </ul>
     </ul>
   </div>

</div>

   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_loadTree").click(function(event) {
            event.preventDefault();

            var dict = jQuery("#tree2").dynatree("getTree").toDict();

            var formLoadWBS = jQuery("#formLoadWBS");
            formLoadWBS.find("input[name=wbsElementId]").val('123');

            jQuery.ajax({
               type: "GET",
               url: formLoadWBS.attr("action"),
               data: formLoadWBS.serialize(),
               success: function(data) {
                  alert("WBS Loaded: " + data);
		  //jQuery("#tree2").dynatree({ children: jQuery.parseJSON(data) });
		  jQuery("#tree2").dynatree("getTree").addChild( jQuery.parseJSON(data) );
		  
               },
               error:  function(data) {
                  alert("WBS Load ERROR: " + data);
               }
            });
         });
      });
   </script>

   <form id="formLoadWBS" method="get" action="tests/dynatree_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="loadWBS" />
         <input type="hidden" name="wbsElementId" value="" />
      </fieldset>
   </form>
