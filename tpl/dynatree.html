<div id="content">

<style type="text/css">
  ul.dynatree-container span.td {
     position: absolute;
     display: inline;
     border-size: 1px;
     overflow: hidden;
     background-color: white;
  }
  ul.dynatree-container span.td:nth-child(1) {
     position: static;
  }
  ul.dynatree-container span.td:nth-child(2) {
     left: 300px;
     width: 130px;
  }
  ul.dynatree-container span.td:nth-child(3) {
     left: 430px;
     width: 130px;
  }
  </style>

  <script src="js/progress.js" type="text/javascript"></script>
  <script type="text/javascript">
    $(function(){
      $("#tree").dynatree({
        // using default options
      });

      $("#tree2").dynatree({
            onCustomRender: function(node) {

            // Render title as columns
            if( (null == node.data.title) ||
                (node.data.title.indexOf("~") === -1)) {
              // Default rendering
              return false;
            }
            var cols = node.data.title.split("~"),
            html = "<a class='dynatree-title' href='#'>";
            for(var i=0; i<cols.length; i++){
               html += "<span class='td'>" + cols[i] + "</span>";
            }
            return html + "</a>";
          }
      });

    });
  </script>

   <h1>WBS Edit</h1>
  <a id="bt_saveTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_save.png" style="vertical-align: middle;" title="{t}Save{/t}"> Save</a>

  <div id="tree">
    <ul id="treeData" style="display: none;">
      <li id="57" class="folder expanded">WBS renamed
        <ul>
         <li id="1500">aaa mantis task
         <li id="1532">another mantis task
          <li id="1555">check dynatree library
          <li id="1556">define WbsElement class
         <li id = "63" class="folder expanded">Dashboard 2
           <ul>
             <li id = "67" class="folder">Dashboard Items 2
               <ul>
                 <li id="1602">convert all indicators to dashboard items
                 <li id="1557">define WbsElement in DB
                 <li id="1603">include filters in dashboard items
               </ul>
           </ul>
             <li id = "64" class="folder">Dashboard Homepage 2
               <ul>
                 <li id="1600">add dashboard
                 <li id="1601">add basic indicators
               </ul>
        </ul>
    </ul>
  </div>


   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_saveTree").click(function(event) {
            event.preventDefault();

            var dict = $("#tree").dynatree("getTree").toDict().children;
            var jsonDict = JSON.stringify(dict);
            console.log("saveWBS = ", jsonDict);

            var formSaveWBS = jQuery("#formSaveWBS");
            formSaveWBS.find("input[name=jsonDynatreeDict]").val(jsonDict);

            jQuery.ajax({
               type: "GET",
               url: formSaveWBS.attr("action"),
               data: formSaveWBS.serialize(),
               success: function(data) {
                  console.log("WBS Saved: ", data);
               },
               error:  function(data) {
                  alert("WBS Save ERROR: " + data);
               }
            });
         });

      });
   </script>

   <form id="formSaveWBS" method="get" action="tests/dynatree_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="saveWBS" />
         <input type="hidden" name="jsonDynatreeDict" value="" />
         <input type="hidden" name="nodesToDelete" value="" />
         <input type="hidden" name="wbsRootId" value="{$wbsRootId}" />
      </fieldset>
   </form>


   <h1>WBS Display</h1>

   <a id="bt_loadTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_refresh.png" style="vertical-align: middle;" title="{t}Load{/t}"> Load</a>

   <div id="tree2">
     <ul id="treeData2" style="display: none;">
       <li id="bse1" class="folder expanded">WBS~<div class="progress">20%</div>~col2
         <ul>
   			<li id="20">a mantis task with a long long long description~<div class="progress">10%</div>~col2
				<li id="21">another mantis task~<div class="progress">15%</div>
           <li id="22">check dynatree library~<div class="progress">25%</div>~col2
           <li id="23">define WbsElement class~<div class="progress">30%</div>~col2
           <li id="24">define WbsElement in DB~<div class="progress">35%</div>~col2
         </ul>
     </ul>
   </div>

</div>

   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_loadTree").click(function(event) {
            event.preventDefault();

            var dict = jQuery("#tree2").dynatree("getTree").toDict();

            var formLoadWBS = jQuery("#formLoadWBS");
            formLoadWBS.find("input[name=wbsRootId]").val('{$wbsRootId}');

            jQuery.ajax({
               type: "GET",
               url: formLoadWBS.attr("action"),
               data: formLoadWBS.serialize(),
               success: function(data) {
                  console.log("WBS Loaded: " , data);
                  jQuery("#tree2").dynatree("getRoot").addChild( jQuery.parseJSON(data) );

               },
               error:  function(data) {
                  alert("WBS Load ERROR: " + data);
               }
            });
         });
      });
   </script>

   <form id="formLoadWBS" method="get" action="tests/dynatree_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="loadWBS" />
         <input type="hidden" name="wbsRootId" value="" />
      </fieldset>
   </form>
