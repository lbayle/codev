<div id="content">
   {include file="form/projectFilterDialogbox.html"}

   {if isset($projects)}
   <div class="center">
      <form name="projectForm" id="projectForm" method="get" action="{$page}">
         <fieldset>
            <label for="projectid">{t}Project{/t}: </label>
            <select id="projectid" name="projectid">
               {foreach from=$projects key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <a title="{t}Set project filters{/t}" id="projectFilters" style="text-decoration: none" href="{$page}">
               <img border="0" width="16" height="12" align="absmiddle" src="images/{if isset($filterResults) && count($filterResults) > 0}im-filter-active.png{else}im-filter.png{/if}" alt="{t}Set project filters{/t}" />
            </a>
            <input type="hidden" name="selectedFilters" value="{$selectedFilters}" />
            <input type="submit" value="{t}Jump{/t}" />
         </fieldset>
      </form>
   </div>
   {/if}
   {if isset($overviewTotal) || isset($detailedMgrTotal) || isset($detailedTotal) || isset($issuesTotal)}
   <h3>{t}Project Info{/t}</h3>
   <script src="js/tabs.js" type="text/javascript"></script>
   <div id="tabsVersions" class="tabs">
      <ul>
         <li><a href="#tabVersionsDetailedMgr">{t}Detailed Mgr{/t}</a></li>
         <li><a href="#tabVersionsDetailed">{t}Detailed{/t}</a></li>
         <li><a href="#tabVersionsOverview">{t}Overview{/t}</a></li>
         <li><a href="#tabVersionsIssues">{t}Tasks{/t}</a></li>
      </ul>
      <div id="tabVersionsOverview">

         {assign var=filterResultsTitles value=$overviewTitles}
         {assign var=filterResultsLines value=$overviewLines}
         {assign var=filterResultsTotal value=$overviewTotal}
         {if isset($filterResultsTotal)}

            <table>
               <thead>

               {if 0 == $nbFilters}
               <th></th>
               {/if}
               {foreach from=$filterResultsTitles key=id item=ftitle}
                     <th style="width: 9em;">{$ftitle}</th>
               {/foreach}
               </thead>

               <tbody>
               {foreach from=$filterResultsLines key=id item=line}
                  <tr>
                     {for $idx=1 to $nbFilters}
                     <td>{$line[$idx]}</td>
                     {/for}
                     <!--<td>{$line[$nbFilters+1].date}</td>-->
                     <td><div class="progress">{$line[$nbFilters+1].progressMgr}%</div></td>
                     <td><div class="progress">{$line[$nbFilters+1].progress}%</div></td>
                     <td {if $line[$nbFilters+1].driftMgrColor}style='background-color: #{$line[$nbFilters+1].driftMgrColor};'{/if} title="{t}nb days{/t}">{$line[$nbFilters+1].driftMgr}</td>
                     <td {if $line[$nbFilters+1].driftColor}style='background-color: #{$line[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$line[$nbFilters+1].drift}</td>

                  <tr>
               {/foreach}
                  <tr class="row_total">
                     <td>TOTAL</td>
                     {for $idx=1 to ($nbFilters-1)}
                     <td></td>
                     {/for}
                     <!--<td>{$filterResultsTotal[$nbFilters+1].date}</td>-->
                     <td><div class="progress">{$filterResultsTotal[$nbFilters+1].progressMgr}%</div></td>
                     <td><div class="progress">{$filterResultsTotal[$nbFilters+1].progress}%</div></td>
                     <td {if $filterResultsTotal[$nbFilters+1].driftMgrColor}style='background-color: #{$filterResultsTotal[$nbFilters+1].driftMgrColor};'{/if} title="{t}nb days{/t}">{$filterResultsTotal[$nbFilters+1].driftMgr}</td>
                     <td {if $filterResultsTotal[$nbFilters+1].driftColor}style='background-color: #{$filterResultsTotal[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$filterResultsTotal[$nbFilters+1].drift}</td>
                  <tr>
               </tbody>
            </table>
         {else}
         {t}No data{/t}
         {/if}


      </div>
      <div id="tabVersionsDetailedMgr">

         {assign var=filterResultsTitles value=$detailedMgrTitles}
         {assign var=filterResultsLines value=$detailedMgrLines}
         {assign var=filterResultsTotal value=$detailedMgrTotal}
         {if isset($filterResultsTotal)}

            <table>
               <thead>

               {if 0 == $nbFilters}
               <th></th>
               {/if}
               {foreach from=$filterResultsTitles key=id item=ftitle}
                     <th style="width: 9em;">{$ftitle}</th>
               {/foreach}
               </thead>

               <tbody>
               {foreach from=$filterResultsLines key=id item=line}
                  <tr>
                     {for $idx=1 to $nbFilters}
                     <td>{$line[$idx]}</td>
                     {/for}
                     <td>{$line[$nbFilters+1].effortEstim}</td>
                     <td>{$line[$nbFilters+1].reestimated}</td>
                     <td>{$line[$nbFilters+1].elapsed}</td>
                     <td>{$line[$nbFilters+1].backlog}</td>
                     <td {if $line[$nbFilters+1].driftColor}style='background-color: #{$line[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$line[$nbFilters+1].drift}</td>

                  <tr>
               {/foreach}
                  <tr class="row_total">
                     <td>TOTAL</td>
                     {for $idx=1 to ($nbFilters-1)}
                     <td></td>
                     {/for}
                     <td>{$filterResultsTotal[$nbFilters+1].effortEstim}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].reestimated}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].elapsed}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].backlog}</td>
                     <td {if $filterResultsTotal[$nbFilters+1].driftColor}style='background-color: #{$filterResultsTotal[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$filterResultsTotal[$nbFilters+1].drift}</td>
                  <tr>
               </tbody>
            </table>
         {else}
         {t}No data{/t}
         {/if}

      </div>
      <div id="tabVersionsDetailed">

         {assign var=filterResultsTitles value=$detailedTitles}
         {assign var=filterResultsLines value=$detailedLines}
         {assign var=filterResultsTotal value=$detailedTotal}
         {if isset($filterResultsTotal)}

            <table>
               <thead>

               {if 0 == $nbFilters}
               <th></th>
               {/if}
               {foreach from=$filterResultsTitles key=id item=ftitle}
                     <th style="width: 9em;">{$ftitle}</th>
               {/foreach}
               </thead>

               <tbody>
               {foreach from=$filterResultsLines key=id item=line}
                  <tr>
                     {for $idx=1 to $nbFilters}
                     <td>{$line[$idx]}</td>
                     {/for}
                     <td>{$line[$nbFilters+1].effortEstim}</td>
                     <td>{$line[$nbFilters+1].reestimated}</td>
                     <td>{$line[$nbFilters+1].elapsed}</td>
                     <td>{$line[$nbFilters+1].backlog}</td>
                     <td {if $line[$nbFilters+1].driftColor}style='background-color: #{$line[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$line[$nbFilters+1].drift}</td>

                  <tr>
               {/foreach}
                  <tr class="row_total">
                     <td>TOTAL</td>
                     {for $idx=1 to ($nbFilters-1)}
                     <td></td>
                     {/for}
                     <td>{$filterResultsTotal[$nbFilters+1].effortEstim}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].reestimated}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].elapsed}</td>
                     <td>{$filterResultsTotal[$nbFilters+1].backlog}</td>
                     <td {if $filterResultsTotal[$nbFilters+1].driftColor}style='background-color: #{$filterResultsTotal[$nbFilters+1].driftColor};'{/if} title="{t}nb days{/t}">{$filterResultsTotal[$nbFilters+1].drift}</td>
                  <tr>
               </tbody>
            </table>
         {else}
         {t}No data{/t}
         {/if}

      </div>
      <div id="tabVersionsIssues">

         {assign var=filterResultsTitles value=$issuesTitles}
         {assign var=filterResultsLines value=$issuesLines}
         {assign var=filterResultsTotal value=$issuesTotal}
         {if isset($filterResultsTotal)}

            <table>
               <thead>

               {if 0 == $nbFilters}
               <th></th>
               {/if}
               {foreach from=$filterResultsTitles key=id item=ftitle}
                     <th>{$ftitle}</th>
               {/foreach}
               </thead>

               <tbody>
               {foreach from=$filterResultsLines key=id item=line}
                  <tr>
                     {for $idx=1 to $nbFilters}
                     <td>{$line[$idx]}</td>
                     {/for}
                     <td>{$line[$nbFilters+1].newList}</td>
                     <td>{$line[$nbFilters+1].openList}</td>
                     <td>{$line[$nbFilters+1].resolvedList}</td>

                  <tr>
               {/foreach}
               </tbody>
            </table>
         {else}
         {t}No data{/t}
         {/if}

      </div>
   </div>
   {/if}
   {if isset($currentIssuesInDrift) || isset($resolvedIssuesInDrift)}
   <h3 style="margin-top: 2em">{t}Tasks in drift{/t}</h3>
   <div id="tabsDrift" class="tabs">
      <ul>
         <li><a href="#tabCurrentDrift">{t}Drift current tasks{/t}</a></li>
         <li><a href="#tabResolvedDrift">{t}Drift resolved tasks{/t}</a></li>
      </ul>
      <div id="tabCurrentDrift">
         {if $currentIssuesInDrift}
         <table>
            <!--<caption>{t}Tasks in drift{/t}</caption>-->
            <thead>
               <tr>
                  <th>{t}ID{/t}</th>
                  <th>{t}Project{/t}</th>
                  <th>{t}Target{/t}</th>
                  {if $isManager}<th title="{t}Drift relatively to the managers Estimation{/t}">{t}Drift Mgr{/t}</th>{/if}
                  <th title="{t}Drift relatively to (EE + AddEE){/t}">{t}Drift{/t}</th>
                  <th title="{t}Backlog{/t}">{t}BL{/t}</th>
                  <th>{t}Progress{/t}</th>
                  <th>{t}Status{/t}</th>
                  <th>{t}Summary{/t}</th>
               </tr>
            </thead>
            <tbody>
               {foreach from=$currentIssuesInDrift key=name item=i}
               <tr>
                  <td>{$i.mantisURL} {$i.issueURL}</td>
                  <td>{$i.projectName}</td>
                  <td>{$i.targetVersion}</td>
                  {if $isManager}<td style="width: 6em;{if $i.driftMgrColor}background-color: #{$i.driftMgrColor};{/if}">{$i.driftMgr}</td>{/if}
                  <td style="width: 6em;{if $i.driftColor}background-color: #{$i.driftColor};{/if}">{$i.drift}</td>
                  <td>{$i.backlog}</td>
                  <td>{$i.progress}%</td>
                  <td>{$i.currentStatusName}</td>
                  <td>{$i.summary}</td>
               </tr>
               {/foreach}
            </tbody>
         </table>
         {else}
         {t}No data{/t}
         {/if}
      </div>
      <div id="tabResolvedDrift">
         {if $resolvedIssuesInDrift}
         <table>
            <!--<caption>{t}Tasks in drift{/t}</caption>-->
            <thead>
               <tr>
                  <th>{t}ID{/t}</th>
                  <th>{t}Project{/t}</th>
                  <th>{t}Target{/t}</th>
                  {if $isManager}<th style="width: 6em;" title="{t}Drift relatively to the managers Estimation{/t}">{t}Drift Mgr{/t}</th>{/if}
                  <th style="width: 6em;" title="{t}Drift relatively to (EE + AddEE){/t}">{t}Drift{/t}</th>
                  <th title="{t}Backlog{/t}">{t}BL{/t}</th>
                  <th>{t}Progress{/t}</th>
                  <th>{t}Status{/t}</th>
                  <th>{t}Summary{/t}</th>
               </tr>
            </thead>
            <tbody>
               {foreach from=$resolvedIssuesInDrift key=name item=i}
               <tr>
                  <td>{$i.mantisURL} {$i.issueURL}</td>
                  <td>{$i.projectName}</td>
                  <td>{$i.targetVersion}</td>
                  {if $isManager}<td {if $i.driftMgrColor}style='background-color: #{$i.driftMgrColor};'{/if}>{$i.driftMgr}</td>{/if}
                  <td {if $i.driftColor}style='background-color: #{$i.driftColor};'{/if}>{$i.drift}</td>
                  <td>{$i.backlog}</td>
                  <td>{$i.progress}%</td>
                  <td>{$i.currentStatusName}</td>
                  <td>{$i.summary}</td>
               </tr>
               {/foreach}
            </tbody>
         </table>
         {else}
         {t}No data{/t}
         {/if}
      </div>
   </div>
   {/if}
   {if isset($error)}
   <p class="center ui-state-error-text">{t}{$error}{/t}</p>
   {/if}
</div>
