<script type="text/javascript" src="js/datepicker.js"></script>

<script type="text/javascript">
   jQuery(document).ready(function() {
      {if $locale != en}
      jQuery.datepicker.setDefaults($.datepicker.regional['{$locale}']);
      {/if}

      // Set the date
      jQuery("#commandsetDate").datepicker("setDate" ,"{$commandsetDate}");

      // DialogBox for deleteCommandSet
      jQuery("#btDeleteCommandSet").click(function(event) {
         jQuery( "#deleteCommandSet_dialog_form").dialog("open");
      });

      // delete track dialogBox
      jQuery("#deleteCommandSet_dialog_form").dialog({
         autoOpen: false,
         resizable: true,
         width: "auto",
         modal: true,
         buttons: {
            "Delete": function() {
               jQuery("#formDeleteCommandSet").submit();
            },
            Cancel: function() {
               jQuery(this).dialog("close");
            }
         }
      });
   });
</script>

<!-- DialogBox for deleteCommand -->
<div id="deleteCommandSet_dialog_form" title="{t}Delete CommandSet{/t}" class="ui-helper-hidden">
   <p><span class="ui-icon ui-icon-alert float" style="margin:0 7px 20px 0;"></span>
      {t}Delete this CommandSet ?{/t}
   </p>
   <table class="invisible">
      <tr>
         <td><span style="font-weight:bold;">{t}Name{/t}</span></td>
         <td>: </td>
         <td>{$commandsetName}</td>
      </tr>
      <tr>
         <td><span style="font-weight:bold;">{t}Nb Commands{/t}</span></td>
         <td>: </td>
         <td>{$nbCommands}</td>
      </tr>
      <tr>
         <th valign='top'><span style="font-weight:bold;">{t}Service Contracts{/t}</span></th>
         <td valign='top'>: </td>
         <td>
            {foreach from=$parentContracts key=id item=i}{$i}<br />{/foreach}
         </td>
      </tr>
   </table>
   <form id="formDeleteCommandSet" name="formDeleteCommandSet" method="post" action="{$page}" >
      <fieldset>
         <input type="hidden" name="action" value="deleteCommandSet" />
         <input type="hidden" name="commandid" value="{$commandsetid}" />
         <input type="hidden" name="teamid" value="{$teamid}" />
      </fieldset>
   </form>
</div>

<div id="content">

   <div align="center">
      <h2 title="{$commandsetid}">{$commandsetName}</h2>
   </div>

   <br/><br/>

   <div>
      <!-- create form -->
      <form id='updateCommandSetInfoForm' name='updateCommandSetInfoForm' method='post' action='{$page}'>
         <fieldset>
            <table class='invisible'>
               <tr>
                  <th><label for="teamSelector">{t}Team{/t}</label></th>
                  <td>
                     <select id='teamSelector' name='teamid'>
                        <!--option value='0'></option-->
                        {foreach from=$teams key=id item=i}
                        <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
                        {/foreach}
                     </select>
                  </td>
               </tr>
               <tr>
                  <th><label for="commandsetName">{t}Name{/t}</label></th>
                  <td><input type='text' size='80' style='font-family: sans-serif' name='commandsetName' id='commandsetName' value='{$commandsetName}'></td>
               </tr>
               <tr>
                  <th><label for="commandsetReference">{t}Reference{/t}</label></th>
                  <td><input type='text' style='font-family: sans-serif' name='commandsetReference' id='commandsetReference' value='{$commandsetReference}'></td>
               </tr>
               <tr>
                  <th><label for="commandsetDesc">{t}Description{/t}</label></th>
                  <td><textarea rows='4' cols='80' style='font-family: sans-serif' name='commandsetDesc' id='commandsetDesc'>{$commandsetDesc}</textarea></td>
               </tr>
               <tr>
                  <th><label for="commandsetDate">{t}Date{/t}</label></th>
                  <td><input type="text" id="commandsetDate" name="commandsetDate" class="datepicker" maxlength="10" size="10" title="{t}Date{/t}" />
                  </td>
               </tr>
               <tr>
                  <th><label for="commandsetCost">{t}Cost{/t}</label></th>
                  <td><input type='text' style='font-family: sans-serif' name='commandsetCost' id='commandsetCost' value='{$commandsetCost}'> {t}EUR{/t}</td>
               </tr>
               <tr>
                  <th><label for="commandsetBudget">{t}Budget{/t}</th>
                  <td><input type='text' style='font-family: sans-serif' name='commandsetBudget' id='commandsetBudget' value='{$commandsetBudget}'> {t}days{/t}</td>
               </tr>
            </table>
            <br />
            <button type='button' name="btDeleteCommandSet" id="btDeleteCommandSet"><img  border='0' align='absmiddle' src="images/b_drop.png" alt="Delete icon"/> {t}Delete{/t}</button>
            <button type='submit'><img  border='0' align='absmiddle' src="images/b_save.png" alt="Save icon"/> {t}{$cmdsetInfoFormBtText}{/t}</button>

            <input type="hidden" name="action" value="{$cmdsetInfoFormAction}" />
            <input type="hidden" name="commandsetid" value="{$commandsetid}" />
         </fieldset>
      </form>
   </div>

   <div style="margin-top:4em;">

   <script src="js/tabs.js" type="text/javascript"></script>
   <div id="tabsCommandSet" class="tabs">
      <ul>
         <li><a href="#tabsName-1">{t}Commands{/t}</a></li>
      </ul>

      <div id="tabsName-1">
         <div style="margin-top:1em;">

         {if $isAddCmdForm}
         <div align="left">
            <!-- add/create command form -->
            <form id='addCmdForm' name='addCmdForm' method='post' action='{$page}'>
               <fieldset>
                  <select id='cmdSelector' name='cmdid'>
                     <option value='0'>{t}--- New Command ---{/t}</option>
                     {foreach  $cmdCandidates as $id => $name}
                     <option value="{$id}">{$name}</option>
                     {/foreach}
                  </select>

                  <button type='submit'><img  border='0' align='absmiddle' src="images/b_add.png" alt="Add icon"/> {t}Add{/t}</button>

                  <input type="hidden" name="action" value="addCommand" />
                  <input type="hidden" name="teamid" value="{$teamid}" />
                  <input type="hidden" name="commandsetid" value="{$commandsetid}" />
               </fieldset>
            </form>
         </div>
         {/if}

         <div style="margin-top:1em;">
         {if $cmdList}

         <script type="text/javascript">
            function removeCmd(cmdid, description){
               jQuery("#desc_id").text(cmdid);
               jQuery("#desc_summary").text(description);

               jQuery("#formRemoveCmd").find("input[name=cmdid]").val(cmdid);

               jQuery("#removeCmd_dialog_form").dialog("open");
            }
         </script>
         <script type="text/javascript">
            jQuery(document).ready(function() {
               // delete track dialogBox
               jQuery("#removeCmd_dialog_form").dialog({
                  autoOpen: false,
                  resizable: true,
                  width: "auto",
                  modal: true,
                  buttons: {
                     "Remove": function() {
                        jQuery("#formRemoveCmd").submit();
                     },
                     Cancel: function() {
                        jQuery(this).dialog("close");
                     }
                  }
               });
            });
         </script>
         <div id="removeCmd_dialog_form" title="{t}Remove Command{/t}" class="ui-helper-hidden">
            <p><span class="ui-icon ui-icon-alert float" style="margin:0 7px 20px 0;"></span>
               {t}Remove Command from this CommandSet ?{/t}
            </p>
            <table class="invisible">
               <tr>
                  <td><span style="font-weight:bold;">{t}Id{/t} :</span></td>
                  <td id="desc_id">id</td>
               </tr>
               <tr>
                  <td><span style="font-weight:bold;">{t}Description{/t} :</span></td>
                  <td id="desc_summary">summary</td>
               </tr>
            </table>
            <form id="formRemoveCmd" name="formRemoveCmd" method="post" action="{$page}" >
               <fieldset>
                  <input type="hidden" name="action" value="removeCmd" />
                  <input type="hidden" name="cmdid"  value="0" />
                  <input type="hidden" name="teamid" value="{$teamid}" />
                  <input type="hidden" name="commandsetid"  value="{$commandsetid}" />
               </fieldset>
            </form>
         </div>

         <table>
            <thead>
               <tr>
                  <th></th>
                  <th>{t}Ref{/t}</th>
                  <th>{t}Command{/t}</th>
                  <th>{t}Team{/t}</th>
               </tr>
            </thead>
            <tbody>
               {foreach $cmdList as $id => $cmd}
               <tr>
                  <td class="ui-state-error-text" style="width:1em;">
                     <a class="ui-icon" title="{t}delete CommandSet-Command association{/t}" href="{$page}"
                        onclick="removeCmd('{$id}', '{$cmd.name|escape}');return false;"></a>
                  </td>
                  <td>{$cmd.reference}</td>
                  <td title="{$id}">{$cmd.name}</td>
                  <td>{$cmd.team}</td>
               </tr>
               {/foreach}
            </tbody>
         </table>
         {else}
         {t}Create the CommandSet to add some commands.{/t}
         {/if}
      </div>
   </div>
</div>