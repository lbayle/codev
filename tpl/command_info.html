<script type="text/javascript">
   jQuery(document).ready(function() {
      jQuery("#teamid").change(function() {
         var form = jQuery('#selectForm');
         form.find("select[name=cmdid]").val("0");
         form.find("input[name=action]").val("setTeam");
         form.submit();
      });

      jQuery("#sendForm").click(function() {
         var form = jQuery('#selectForm');
         form.find("input[name=action]").val("displayCommand");
         form.submit();
      });
   });
</script>

<div id="content">

   <div align="center">
      <!-- create form -->
      <form id="selectForm" name="selectForm" class="formWithTabsHistory" method="post" action="{$page}">
         <fieldset>
            <label for="teamid">{t}Team{/t}: </label>
            <select id="teamid" name="teamid">
               <option value="0"></option>
               {foreach from=$teams key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <label for="cmdid">{t}Command{/t}: </label>
            <select id="cmdid" name="cmdid" class="select2" style="width:400px;">
               {foreach from=$commands key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.reference} {$i.name}</option>
               {/foreach}
               <option value="0">{t}--- Create New Command ---{/t}</option>
            </select>
            <input type="button" id="sendForm" value="{t}Jump{/t}" />
            <input type="hidden" name="action" value="displayCommand" />
         </fieldset>
      </form>
   </div>

   {if isset($cmdid)}
   {include file="modal/consistency_check.html"}
   
   <div align="center">
      <h2>{$cmdReference} {$cmdName}</h2>
      {$cmdDesc}
   </div>

   <div style="margin-top: 2em;">
      <table class="invisible">
         <tr>
            <th>{t}Reference{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdReference}</td>
         </tr>
         <tr>
            <th>{t}Version{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdVersion}</td>
         </tr>
         <tr>
            <th>{t}Reporter{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdReporter}</td>
         </tr>
         <tr>
            <th>{t}Start date{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdStartDate}</td>
         </tr>
         <tr>
            <th>{t}End date{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdDeadline}</td>
         </tr>
         <tr>
            <th>{t}State{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdState}</td>
         </tr>
         <tr>
            <th>{t}Cost{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdCost} {$cmdCurrency}</td>
         </tr>
         <tr>
            <th>{t}Budget{/t}</th>
            <td valign="top">: </td>
            <td>{$cmdBudgetDev} {t}days{/t}</td>
         </tr>
         <tr>
            <th valign="top">{t}CommandSet{/t}</th>
            <td valign="top">: </td>
            <td>
               {foreach from=$parentCmdSets key=id item=i}
               <a href="management/commandset_info.php?commandsetid={$id}">{$i}</a><br />
               {/foreach}
            </td>
         </tr>
      </table>
      {if isset($isEditGranted) && $isEditGranted}
      <button onclick="location.href='management/command_edit.php'"><img  border="0" align="absmiddle" src="images/b_edit.png" alt="Edit icon"/> {t}Edit{/t}</button>
      {/if}
   </div>

   {include file="tools/graph.html"}
   <script src="js/tabs.js" type="text/javascript"></script>
   <div id="tabsCommand" class="tabs" style="margin-top:2em;">
      <ul>
         <li><a href="#tabsName-3">{t}Charges{/t}</a></li>
         <li><a href="#tabsName-4">{t}Activity{/t}</a></li>
         <li><a href="#tabsName-1">{t}Tasks{/t} ({$cmdNbIssues})</a></li>
         <li><a href="#tabsName-2">{t}Indicators{/t}</a></li>
      </ul>

      <div id="tabsName-3">
         {if $cmdDetailedMgr}
         <table>
            <thead>
               <tr>
                  <th>{t}MgrEffortEstim{/t}</th>
                  <th title="backlogMgr + elapsed">{t}Reestimated Mgr{/t}</th>
                  <th>{t}Elapsed{/t}</th>
                  <th>{t}Backlog Mgr{/t}</th>
                  <th style="width: 80px">{t}Drift Mgr{/t}</th>
                  <th>{t}Progress{/t}</th>
               </tr>
            </thead>
            <tbody>
               <tr>
                  <td>{$cmdDetailedMgr.effortEstim}</td>
                  <td>{$cmdDetailedMgr.reestimated}</td>
                  <td>{$cmdDetailedMgr.elapsed}</td>
                  <td>{$cmdDetailedMgr.backlog}</td>
                  <td {$cmdDetailedMgr.driftColor} title="{t}nb days{/t}">{$cmdDetailedMgr.drift}</td>
                  <td><div class="progress">{$cmdDetailedMgr.progress}%</div></td>
               </tr>
            </tbody>
         </table>
         {else}
         {t}No task found.{/t}
         {/if}
      </div>

      <div id="tabsName-1">
         {if $cmdShortIssueList}
         {t}Short List: {/t}<br>{$cmdShortIssueList}<br>
         {/if}

         {if $cmdIssues}
         <div align="center">
            <table id="issues_table" class="datatable">
               <thead>
                  <tr>
                     <th>{t}ID{/t}</th>
                     <th>{t}ExtRef{/t}</th>
                     <th>{t}Project{/t}</th>
                     <th>{t}Target{/t}</th>
                     <th>{t}Status{/t}</th>
                     <th>{t}Progress{/t}</th>
                     <th>{t}MgrEffortEstim{/t}</th>
                     <th>{t}Elapsed{/t}</th>
                     <th title="{t}Backlog{/t}">{t}BL{/t}</th>
                     <th>{t}Drift Mgr{/t}</th>
                     <th>{t}Summary{/t}</th>
                  </tr>
               </thead>
               <tbody>
                  {foreach $cmdIssues as $id => $issue}
                  <tr>
                     <!--td>{$issue.mantisLink}{$issue.bugid}</td-->
                     <td>{$issue.bugid}</td>
                     <td>{$issue.extRef}</td>
                     <td>{$issue.project}</td>
                     <td>{$issue.target}</td>
                     <td>{$issue.status}</td>
                     <td><div class="progress">{$issue.progress}%</div></td>
                     <td>{$issue.effortEstim}</td>
                     <td>{$issue.elapsed}</td>
                     <td>{$issue.durationMgr}</td>
                     <td {$issue.driftMgrColor}>{$issue.driftMgr}</td>
                     <td>{$issue.summary}</td>
                  </tr>
                  {/foreach}
               </tbody>
            </table>
         </div>
         {else}
         {t}No task found.{/t}
         {/if}
      </div>

      <div id="tabsName-2">
         {if $indicators_jqplotData}
            <script type="text/javascript">
               jQuery(document).ready(function() {
                  var chartoptions = jQuery('#indicatorsChart').data('plotoptions');
                  chartoptions.title.text = '{t}Historical Progression Chart{/t}';
                  chartoptions.legend.location = 'nw';
                  chartoptions.series = [{
                     label : "{t}Theoric{/t}"
                  },{
                     label : "{t}Real{/t}"
                  }];
                  chartoptions.axes.xaxis.min = "{$indicators_plotMinDate}";
                  chartoptions.axes.xaxis.max = "{$indicators_plotMaxDate}";
                  chartoptions.axes.yaxis.label = '{t}% Progress{/t}';
                  chartoptions.axes.yaxis.min = 0;
                  jQuery('#indicatorsChart').jqplot({$indicators_jqplotData}, chartoptions);
               });
            </script>
            <div id="indicatorsChart" class="date_chart chart" style="width:100%;"></div>
            {else}
         <p>{t}No data{/t}</p>
         {/if}
      </div>

      <div id="tabsName-4">
      {include file="plugin/activity_indicator.html"}
      </div>

      {/if}
   </div>
   <script type="text/javascript">
      jQuery(document).ready(function() {
         jQuery.ajax({
            url: "js/datatable.js",
            dataType: "script",
            cache: true
         });
      });
   </script>
</div>
