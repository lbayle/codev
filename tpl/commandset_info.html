{include file="menu/management_menu.html"}

<script type="text/javascript">
   jQuery(document).ready(function() {
      jQuery("#teamid").change(function() {
         var form = jQuery('#selectForm');
         form.find("select[name=commandsetid]").val("0");
         form.find("input[name=action]").val("setTeam");
         form.submit();
      });

      jQuery("#sendForm").click(function() {
         var form = jQuery('#selectForm');
         form.submit();
      });
   });
</script>

<div id="content">
   <div align="center">
      <!-- create form -->
      <form id="selectForm" name="selectForm" method="post" action="{$page}">
         <fieldset>
            <label for="teamid">{t}Team{/t}:</label>
            <select id="teamid" name="teamid">
               <option value="0"></option>
               {foreach from=$teams key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <label for="commandsetid">{t}CommandSet{/t}:</label>
            <select id="commandsetid" name="commandsetid" class="select2">
               {foreach from=$commandsets key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
               <option value="0">{t}--- Create New CommandSet ---{/t}</option>
            </select>
            <input type="button" id="sendForm" value="{t}Jump{/t}" />
            <input type="hidden" name="action" value="displayCommandSet" />
         </fieldset>
      </form>
   </div>

   {if $commandsetid}

   {include file="modal/consistency_check.html"}

   <div align="center">
      <h2>{$commandsetName}</h2>
      {$commandsetDesc|nl2br}
   </div>

   <div style="margin-top:2em;">
      <table class="invisible">
         <tr>
            <th>{t}Reference{/t}</th>
            <td valign="top">: </td>
            <td>{$commandsetReference}</td>
         </tr>
         <tr>
            <th>{t}Date{/t}</th>
            <td valign="top">: </td>
            <td>{$commandsetDate}</td>
         </tr>
         <tr>
            <th>{t}Cost{/t}</th>
            <td valign="top">: </td>
            <td>{$commandsetCost} {$commandsetCurrency}</td>
         </tr>
         <tr>
            <th>{t}Budget{/t}</th>
            <td valign="top">: </td>
            <td>{$commandsetBudget} {t}days{/t}</td>
         </tr>
         <tr>
            <th valign="top">{t}Service Contract{/t}</th>
            <td valign="top">: </td>
            <td>
               {foreach from=$parentContracts key=id item=i}
               <a href="management/servicecontract_info.php?servicecontractid={$id}">{$i}</a><br />
               {/foreach}

            </td>
         </tr>
      </table>
      {if $isEditGranted}
      <button onclick="location.href='management/commandset_edit.php'"><img border="0" align="absmiddle" src="images/b_edit.png" alt="Edit icon"/> {t}Edit{/t}</button>
      {/if}
   </div>

   {include file="tools/graph.html"}
   <script src="js/tabs.js" type="text/javascript"></script>
   <div id="tabsCommandSet" class="tabs" style="margin-top:2em;">
      <ul>
         <li><a href="#tabsName-1">{t}Charges{/t}</a></li>
         <li><a href="#tabsName-2">{t}Indicators{/t}</a></li>
      </ul>
      <div id="tabsName-1">
         {if $cmdList}
         <!--table id="devCmd_table" class="display"-->
         <table>
            <thead>
               <tr>
                  <!--th></th-->
                  <th>{t}Ref{/t}</th>
                  <th>{t}Command{/t}</th>
                  <th>{t}Team{/t}</th>
                  <th>{t}MgrEffortEstim{/t}</th>
                  <th title="backlogMgr + elapsed">{t}Reestimated Mgr{/t}</th>
                  <th>{t}Elapsed{/t}</th>
                  <th>{t}Backlog Mgr{/t}</th>
                  <th>{t}Drift Mgr{/t}</th>
                  <th>{t}Progress{/t}</th>
               </tr>
            </thead>
            <tbody>
               {foreach $cmdList as $id => $cmd}
               <tr>
                  <!--td>{$id}</td-->
                  <td align="right"><a href="management/command_info.php?cmdid={$id}"><img title="goto" align="absmiddle" src="images/b_goto.png" /></a> {$cmd.reference}</td>
                  <td title="{$id}"  align="left">{$cmd.name}</td>
                  <td>{$cmd.team}</td>
                  <td>{$cmd.effortEstim}</td>
                  <td>{$cmd.reestimated}</td>
                  <td>{$cmd.elapsed}</td>
                  <td>{$cmd.backlog}</td>
                  <td {$cmd.driftColor}>{$cmd.drift}</td>
                  <td style="width: 110px;"><div class="progress">{$cmd.progress}%</div></td>
               </tr>
               {/foreach}
            </tbody>
            <tfoot>
               <tr>
                  <!--td></td-->
                  <td></td>
                  <td>{t}TOTAL{/t}</td>
                  <td></td>
                  <td>{$cmdsetDetailedMgr.effortEstim}</td>
                  <td>{$cmdsetDetailedMgr.reestimated}</td>
                  <td>{$cmdsetDetailedMgr.elapsed}</td>
                  <td>{$cmdsetDetailedMgr.backlog}</td>
                  <td {$cmdsetDetailedMgr.driftColor}>{$cmdsetDetailedMgr.drift}</td>
                  <td style="width: 110px;"><div class="progress">{$cmdsetDetailedMgr.progress}%</div></td>
               </tr>
            </tfoot>
         </table>
         {else}
         {t}No Command found.{/t}
         {/if}
      </div>
      <div id="tabsName-2">
         {if $indicators_jqplotData}
         <script type="text/javascript">
            jQuery(document).ready(function() {
               var chartoptions = jQuery('#indicatorsChart').data('plotoptions');
               chartoptions.title.text = '{t}Historical Progression Chart{/t}';
               chartoptions.legend.location = 'nw';
               chartoptions.series = [{
                  label : "{t}Theoric{/t}"
               },{
                  label : "{t}Real{/t}"
               }];
               chartoptions.axes.xaxis.min = "{$indicators_plotMinDate}";
               chartoptions.axes.xaxis.max = "{$indicators_plotMaxDate}";
               chartoptions.axes.yaxis.label = '{t}% Progress{/t}';
               chartoptions.axes.yaxis.min = 0;
               jQuery('#indicatorsChart').jqplot([{$indicators_jqplotData}], chartoptions);
            });
         </script>
         <div id="indicatorsChart" class="date_chart chart" style="width:100%;"></div>
         {else}
         <p>{t}No data{/t}</p>
         {/if}
      </div>
      {/if}
   </div>
</div>
