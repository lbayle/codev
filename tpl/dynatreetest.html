<div id="content">

<style type="text/css">
  ul.dynatree-container span.td {
     position: absolute;
     display: inline;
     border-size: 1px;
     overflow: hidden;
     background-color: white;
  }
  ul.dynatree-container span.td:nth-child(1) {
     position: static;
  }
  ul.dynatree-container span.td:nth-child(2) {
     left: 200px;
     width: 120px;
  }
  ul.dynatree-container span.td:nth-child(3) {
     left: 350px;
     width: 100px;
  }
  ul.dynatree-container span.td:nth-child(4) {
     left: 450px;
     width: 100px;
  }
  ul.dynatree-container span.td:nth-child(5) {
     left: 550px;
     width: 100px;
  }
  ul.dynatree-container span.td:nth-child(6) {
     left: 650px;
     width: 100px;
  }
  </style>

  <script src="js/progress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
	  function getJSON() {
		  $.ajax({
		      url: 'include/MySQLtoJSON.php',
		      success: function(){
		          $("#tree").dynatree({
		              // using default options
		              initAjax: {
		              	url: 'tpl/treeData.json'
		              }
		            });

		            $("#tree2").dynatree({
		          	    initAjax: {
		                	url: 'tpl/treeDataDetail.json'
		          	    },
		          	    onCustomRender: function(node) {

		                  // Render title as columns
		                  if( (null == node.data.title) ||
		                      (node.data.title.indexOf("~") === -1)) {
		                    // Default rendering
		                    return false;
		                  }
		                  var cols = node.data.title.split("~"),
		                  html = "<a class='dynatree-title' href='#'>";
		                  html += "<span class='td'>" + cols[0] + "</span>";
			              if(cols.length > 1) {
			            	 html += "<span class='td'><div class='progress ui-progressbar ui-widget ui-widget-content ui-corner-all' ";
			            	 html += "role='progressbar' aria-valuemin='0' aria-valuemax='100' aria-valuenow='" + cols[1] + "'>";
			            	 html += "<div class='ui-progressbar-value ui-widget-header ui-corner-left' style='width: " + cols[1] + "%;'>";
			            	 html += "<div>" + cols[1] + "%</div></div></div></span>";
			              }
		                  for(var i=2; i<cols.length; i++){
		                     html += "<span class='td'>" + cols[i] + "</span>";
		                  }
		                  return html + "</a>";
		          	    }

		            });
		            
		          }

		      });
	  }
	  window.onload = getJSON;
  </script>
  
  <form id="formInitWBS" method="get" action="tests/dynatree_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="saveWBS" />
         <input type="hidden" name="jsonDynatreeDict" value="" />
      </fieldset>
   </form>

   <h1>WBS Edit</h1>
  <a id="bt_saveTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_save.png" style="vertical-align: middle;" title="{t}Save{/t}"> Save</a>

  <div id="tree">
  </div>


   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_saveTree").click(function(event) {
            event.preventDefault();

            var dict = $("#tree").dynatree("getTree").toDict();
            var jsonDict = JSON.stringify(dict);
            var formSaveWBS = jQuery("#formSaveWBS");
            formSaveWBS.find("input[name=jsonDynatreeDict]").val(jsonDict);

            jQuery.ajax({
               type: "GET",
               url: formSaveWBS.attr("action"),
               data: formSaveWBS.serialize(),
               success: function(data) {
                  alert("WBS Saved: " + data);
               },
               error:  function(data) {
                  alert("WBS Save ERROR: " + data);
               }
            });
         });

      });
   </script>

   <form id="formSaveWBS" method="get" action="tests/dynatreetest_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="saveWBS" />
         <input type="hidden" name="jsonDynatreeDict" value="" />
      </fieldset>
   </form>


   <h1>WBS Display</h1>

   <a id="bt_loadTree" style="text-decoration: none" href="{$page}"><img align="absmiddle" src="images/b_refresh.png" style="vertical-align: middle;" title="{t}Load{/t}"> Load</a>
  
   <div id="tree2">
   </div>

</div>

   <script type="text/javascript">

      jQuery(document).ready(function() {
         jQuery("#bt_loadTree").click(function(event) {
            event.preventDefault();

            var dict = jQuery("#tree2").dynatree("getTree").toDict();

            var formLoadWBS = jQuery("#formLoadWBS");
            formLoadWBS.find("input[name=wbsElementId]").val('123');

            jQuery.ajax({
               type: "GET",
               url: formLoadWBS.attr("action"),
               data: formLoadWBS.serialize(),
               success: function(data) {
                  //alert("WBS Loaded: " + data);
                  jQuery("#tree2").dynatree("getRoot").addChild( jQuery.parseJSON(data) );

               },
               error:  function(data) {
                  alert("WBS Load ERROR: " + data);
               }
            });
         });
      });
   </script>

   <form id="formLoadWBS" method="get" action="tests/dynatreetest_ajax.php" >
      <fieldset>
         <input type="hidden" name="action" value="loadWBS" />
         <input type="hidden" name="wbsElementId" value="" />
      </fieldset>
   </form>
