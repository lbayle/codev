function setGanttOptions(){gantt.config.start_date=new Date(commandInfoSmartyData.ganttWindowStartDate);gantt.config.date_grid="%Y-%m-%d";gantt.config.readonly=true;gantt.config.row_height=22;gantt.config.date_scale="%d/%m";gantt.config.subscales=[{unit:"month",step:1,date:"%F %Y"}];gantt.config.xml_date="%d-%m-%Y %H:%i";gantt.templates.scale_cell_class=function(date){if(date.getDay()==0||date.getDay()==6){return"weekend"}};gantt.templates.task_cell_class=function(item,date){if(date.getDay()==0||date.getDay()==6){return"weekend"}};gantt.templates.tooltip_text=function(start,end,task){return task.tooltipHtml};gantt.templates.task_text=function(start,end,task){return task.barText};gantt.templates.rightside_text=function(start,end,task){return task.assignedTo};gantt.config.columns=[{name:"text",label:"Task",width:"*",tree:true},{name:"start_date",label:"Start",align:"center"},{name:"end_date",label:"End",template:function(obj){return obj.end_date_real}},{name:"duration",label:"Backlog",align:"center",template:function(obj){return obj.duration_real}}];gantt.attachEvent("onBeforeTaskDisplay",function(id,task){if(task.isResolved&&!$("#showResolvedFilter").attr("checked")){return false}var summaryFilter=$("#summaryFilter").val();if(task.text.toString().toLowerCase().indexOf(summaryFilter)>=0){return true}if(task.summary.toString().toLowerCase().indexOf(summaryFilter)>=0){return true}if(task.assignedTo.toString().toLowerCase().indexOf(summaryFilter)>=0){return true}return false})}function computeGantt(){$("#ganttDiv").show();$("#ganttBtImg").attr("src","images/spinner.gif");var jsonGanttTasksPromise=$.ajax({url:commandInfoSmartyData.ajaxPage,data:{action:"getGanttTasks",commandId:commandInfoSmartyData.commandId},type:"post",dataType:"json",success:function(data){if("SUCCESS"===data.statusMsg){jsonGanttTasks=data.ganttTasks;gantt.config.end_date=new Date(data.ganttEndDate)}else{$("#ganttBtImg").attr("src","images/b_refresh.png");console.error("Ajax statusMsg",data.statusMsg);alert(data.statusMsg)}},error:function(jqXHR,textStatus,errorThrown){$("#ganttBtImg").attr("src","images/b_refresh.png");console.error(textStatus,errorThrown);alert("ERROR: Please contact your CodevTT administrator")}});$.when(jsonGanttTasksPromise).done(function(){gantt.parse(jsonGanttTasks);console.log("number of tasks currently loaded in the gantt",gantt.getTaskCount());console.log("number of tasks visible on the screen (those that are not collapsed)",gantt.getVisibleTaskCount());$("#ganttBtImg").attr("src","images/b_refresh.png")})}$("#tab_gantt").on("tabscreate",function(event,ui){setGanttOptions();gantt.init("gantt_here");computeGantt()});$("#summaryFilter").bind("enterKey",function(e){gantt.refreshData()});$("#summaryFilter").keyup(function(e){if(e.keyCode==13){$(this).trigger("enterKey")}});jQuery(document).ready(function(){jQuery("#cmdid").change(function(){if("0"!==this.value){var form=jQuery("#mainForm");form.find("input[name=action]").val("displayCommand");form.submit()}});jQuery("#btDisplayPage").click(function(){var form=jQuery("#mainForm");form.find("input[name=action]").val("displayCommand");form.submit()});jQuery("#btCmdStateFilter").click(function(event){event.preventDefault();jQuery("#setCmdStateFilter_dialog_form").dialog("open")});jQuery("#setCmdStateFilter_dialog_form").dialog({autoOpen:false,height:"auto",width:500,modal:true,buttons:[{text:commandInfoSmartyData.i18n_OK,click:function(){var form=jQuery("#formSetStateFilter");var checkItems="";jQuery(".cb_cmdStateFilter").each(function(){var itemName=jQuery(this).attr("name");var isChecked=jQuery(this).attr("checked")?1:0;checkItems+=itemName+":"+isChecked+","});form.find("input[name=checkedCmdStateFilters]").val(checkItems);form.find("input[name=cmdid]").val(jQuery("#cmdid").val());form.submit()}},{text:commandInfoSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]});jQuery("input[type=radio]").change(function(){if(jQuery(this).attr("id")=="radio1"){jQuery(".provisionTotalList").show();jQuery(".provisionsList").hide()}else if(jQuery(this).attr("id")=="radio2"){jQuery(".provisionTotalList").hide();jQuery(".provisionsList").show()}});jQuery.ajax({url:"js_min/datatable.min.js",dataType:"script",cache:true});var regex=new RegExp(/^[0-9]+(\.[0-9][0-9]?5?)?$/i);$.editable.addInputType("effortEstimationInput",{element:function(settings,original){var input=$("<input id=\"input_effort_estimation\" type=\"text\" title=\"'1', '0.3', '2.55' or '2.125'\" required=\"required\">");input.width(settings.width);input.height(settings.height);$(this).append(input);return input},submit:function(settings,original){var updatedValue=document.getElementById("input_effort_estimation").value;if(regex.test(updatedValue)){if(original.revert!==updatedValue){var form=$("form",this);form.submit()}else{original.reset();$(".alert-message").removeClass("error info").html("");return false}}else{var alertMessage=$(".alert-message");var message=$("<div />",{html:commandInfoSmartyData.i18n_format+" : '1', '0.3', '2.55' or '2.125'."});alertMessage.hasClass("info")?alertMessage.removeClass("info").addClass("error").html(message):alertMessage.addClass("error").html(message);original.reset();$(original).trigger("dblclick");return false}}});$("#issues_table").find(".td_editable").editable(function(value,settings){return value},{data:function(value,settings){return value},type:"effortEstimationInput",event:"dblclick",select:true,placeholder:"",onblur:function(value){if(regex.test(value)){if(this.revert!==value){var form=$("form",this);form.submit()}else{this.reset();$(".alert-message").removeClass("error info").html("")}}else{var alertMessage=$(".alert-message");var message=$("<div />",{html:commandInfoSmartyData.i18n_format+" : '1', '0.3', '2.55' or '2.125'."});alertMessage.hasClass("info")?alertMessage.removeClass("info").addClass("error").html(message):alertMessage.addClass("error").html(message);this.reset();$(this).trigger("dblclick")}},callback:function(value,settings){var fieldName=$(this).attr("data-fieldname");if("EffortEstim"==fieldName){var tdDrift=$(this).closest("tr").children("td.td_drift")}else if("MgrEffortEstim"==fieldName){var tdDriftMgr=$(this).closest("tr").children("td.td_drift_mgr")}var bugId=$(this).parent().children(":first-child").text();console.log(commandInfoSmartyData.ajaxPage);$.ajax({type:"GET",url:commandInfoSmartyData.ajaxPage,data:"action=updateTaskData&bugId="+bugId+"&fieldName="+fieldName+"&updatedValue="+value+"&commandId="+commandInfoSmartyData.commandId,dataType:"json",success:function(data){if("SUCCESS"===data.statusMsg){var color=null!==data.taskUpdate.driftColor?"#"+data.taskUpdate.driftColor:"inherit";if(null!==data.taskUpdate.drift&&tdDrift){tdDrift.text(data.taskUpdate.drift);tdDrift.css("background-color",color)}else if(null!==data.taskUpdate.driftMgr&&tdDriftMgr){tdDriftMgr.text(data.taskUpdate.driftMgr);tdDriftMgr.css("background-color",color);var totalDriftColor="#"+data.budgetUpdate.cmdTotalDriftColor;$("#td_prov_and_mee_days").text(data.budgetUpdate.cmdProvAndMeeDays);$("#td_total_reestimated").text(data.budgetUpdate.cmdTotalReestimated);$("#td_total_reestimated").css("background-color",data.budgetUpdate.cmdTotalReestimatedColor);$("#td_total_drift").text(data.budgetUpdate.cmdTotalDrift);$("#td_total_drift").css("background-color",totalDriftColor);$("#td_total_drift_percent").text(data.budgetUpdate.cmdTotalDriftPercent);$("#td_total_drift_percent").css("background-color",totalDriftColor)}$("#bt_loadTree").click();var alertMessage=$(".alert-message");var message=$("<div />",{html:commandInfoSmartyData.i18n_reloadPageToUpdateIndicators});alertMessage.hasClass("error")?alertMessage.removeClass("error").addClass("info").html(message):alertMessage.addClass("info").html(message)}else{console.error("Ajax statusMsg",data.statusMsg);alert(data.statusMsg)}},error:function(jqXHR,textStatus,errorThrown){console.error(textStatus,errorThrown);alert("ERROR: Please contact your CodevTT administrator.")}})}})});
