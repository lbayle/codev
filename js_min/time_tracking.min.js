function updateJobList(e){var t=jQuery("#job");t.empty();var a,r,i=0;for(a in e)e.hasOwnProperty(a)&&i++;for(r in 1<i&&t.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected")),e)e.hasOwnProperty(r)&&t.append(jQuery("<option>").attr("value",r).append(e[r]))}function getIssuesAndDurations(e){e.preventDefault();jQuery("#loading").show();var c=jQuery("#bugid");c.empty(),c.select2("data",null),c.append(jQuery("<option>").attr("value","0").append(timetrackingSmartyData.i18n_pleaseWait).attr("selected","selected")),jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"getIssuesAndDurations",managedUserid:timetrackingSmartyData.userid,projectid:jQuery("#projectid").val()},success:function(e){c.empty(),c.select2("data",null);var t,a=e.availableIssues,r=0;for(t in a)a.hasOwnProperty(t)&&r++;1<r&&c.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));var i,n="";for(o in a)a.hasOwnProperty(o)&&(n=null!=(i=a[o]).tcId&&""!=i.tcId?o+" / "+i.tcId+" : "+i.summary:o+" : "+i.summary,c.append(jQuery("<option>").attr("value",o).append(n)));updateJobList(e.availableJobs),jQuery("#duree").empty();var o,d=e.availableDurations;for(o in d)d.hasOwnProperty(o)&&jQuery("#duree").append(jQuery("<option>").attr("value",o).append(d[o]));jQuery("#loading").hide()},error:function(e,t,a){jQuery("#loading").hide(),console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}})}function addTimetrackAndReload(e){var t=jQuery("#form1"),a=t.find("select[name=bugid]").val(),r=t.find("select[name=trackJobid]").val(),t=t.find("select[name=timeToAdd]").val(),i=jQuery("#datepicker").val();jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"addTimetrack",bugid:a,trackDate:i,trackJobid:r,trackUserid:timetrackingSmartyData.userid,timeToAdd:t,issue_note:e},dataType:"json",success:function(e){"SUCCESS"===e.statusMsg&&((e=jQuery("#formReloadTimetrackingPage")).find("input[name=bugid]").val(a),e.find("input[name=date]").val(i),e.find("input[name=weekid]").val(timetrackingSmartyData.weekid),e.submit())},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}})}jQuery(document).ready(function(){"en"!=timetrackingSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate),jQuery("#projectid").change(function(e){getIssuesAndDurations(e)}),jQuery("#filters").click(function(e){e.preventDefault(),jQuery("#setfilter_dialog_form").dialog("open")}),jQuery("#bugid").change(function(){var e;"0"===jQuery("#projectid").val()&&(e=jQuery("#form1").find("select[name=bugid]").val(),jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getJobList",bugid:e},dataType:"json",success:function(e){"SUCCESS"===e.statusMsg&&updateJobList(e.availableJobs)},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}))}),jQuery("#btAddTrack").click(function(){var e=0,t=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n",a=jQuery("#form1"),r=a.find("select[name=bugid]").val(),i=a.find("select[name=trackJobid]").val(),a=a.find("select[name=timeToAdd]").val();"0"!==r&&""!==r||(t+=timetrackingSmartyData.i18n_task+"\n",++e),"0"!==i&&""!==i||(t+=timetrackingSmartyData.i18n_job+"\n",++e),"0"!==a&&""!==a||(t+=timetrackingSmartyData.i18n_duration+"\n",++e),0===e?(e=jQuery("#datepicker").val(),getUpdateBacklogData(r,timetrackingSmartyData.userid,i,a,e).done(function(e){"BacklogUpdateNotNeeded"===e.diagnostic?addTimetrackAndReload(""):"timetrackNoteOnly"===e.diagnostic?(jQuery("#setTimetrackNoteDlg_taskSummary").text(jQuery("#bugid option:selected").text()),jQuery("#setTimetrackNoteDlg_duration").text(jQuery("#duree option:selected").text()),jQuery("#setTimetrackNoteDlg_job").text(jQuery("#job option:selected").text()),jQuery("#setTimetrackNoteDlg_date").text(jQuery("#datepicker").val()),jQuery("#setTimetrackNoteDlg").dialog("open")):(jQuery("#formUpdateBacklog").off("submit"),openUpdateBacklogDialogbox(e))})):alert(t)}),jQuery("#setTimetrackNoteDlg").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:timetrackingSmartyData.i18n_Ok,click:function(){addTimetrackAndReload(jQuery("#setTimetrackNoteDlg_timetrackNote").val())}},{text:timetrackingSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#setfilter_dialog_form").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=jQuery("#formSetFilters");e.find("input[name=projectid]").val(jQuery("#projectid").val()),e.find("input[name=bugid]").val(jQuery("#bugid").val()),e.find("input[name=job]").val(jQuery("#job").val()),e.find("input[name=duree]").val(jQuery("#duree").val()),e.find("input[name=weekid]").val(jQuery("#weekid").val()),e.find("input[name=year]").val(jQuery("#year").val()),e.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var a=jQuery("#formUpdateWeek");function r(){a.find("input[name=projectid]").val(jQuery("#projectid").val()),a.find("input[name=bugid]").val(jQuery("#bugid").val()),a.find("input[name=job]").val(jQuery("#job").val()),a.find("input[name=duree]").val(jQuery("#duree").val())}jQuery("#previousweek").click(function(){r();var e=jQuery("#weekid").val();1!=e?a.find("select[name=weekid]").val(--e):(t=+jQuery("#year").val()-1,e=timetrackingSmartyData.nbWeeksPrevYear,a.find("select[name=weekid]").val(e),a.find("select[name=year]").val(t));var t=jQuery("#datepicker").val();a.find("input[name=date]").val(t),a.submit()}),jQuery("#nextweek").click(function(){r();var e=jQuery("#weekid").val();parseInt(e)<parseInt(timetrackingSmartyData.nbWeeksThisYear)?a.find("select[name=weekid]").val(++e):(t=+jQuery("#year").val()+1,a.find("select[name=weekid]").val(1),a.find("select[name=year]").val(t));var t=jQuery("#datepicker").val();a.find("input[name=date]").val(t),a.submit()}),jQuery("#weekid, #year").change(function(){r(),a.submit()}),jQuery(".deleteWeekTimetrack_link").click(function(e){e.preventDefault();var t=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getDeleteTimetrackData",timetrackId:t},dataType:"json",success:function(e){"SUCCESS"===e.statusMsg&&(jQuery(".issue_summary").text(e.issueSummary),jQuery("#desc_date").text(e.date),jQuery("#desc_id").text(e.formatedId),jQuery("#desc_duration").text(e.duration),jQuery("#desc_job").text(e.jobName),jQuery("#formDeleteTrack").find("input[name=trackid]").val(t),jQuery("#backlogChangeInfo").text(""),e.isRecreditBacklog&&jQuery("#backlogChangeInfo").text("(Backlog will change to : "+e.futureBacklog+")"))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery("#deleteTrack_dialog_form").dialog("open")}),jQuery("#deleteTrack_dialog_form").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:timetrackingSmartyData.i18n_Delete,click:function(){var e=$("#formDeleteTrack");$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:e.serialize(),success:function(e){var t;"SUCCESS"===e.statusMsg?((t=jQuery("#formReloadTimetrackingPage")).find("input[name=bugid]").val(e.bugid),t.find("input[name=date]").val(e.trackDate),t.submit()):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:timetrackingSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery(".editWeekTimetrack_link").click(function(e){e.preventDefault();var n=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getEditTimetrackData",timetrackId:n},dataType:"json",success:function(e){if("SUCCESS"===e.statusMsg){$("#timeToEdit").empty();var t=e.durationsList;for(a in t)t.hasOwnProperty(a)&&$("#timeToEdit").append($("<option>").attr("value",a).append(t[a]));$("#editJob").empty();var a,r=e.availableJobs;for(a in r)r.hasOwnProperty(a)&&$("#editJob").append($("<option>").attr("value",a).append(r[a]));$("#timetrackId").val(n),$("#timeToEdit").val(e.duration),$("#backlogToEdit").val(e.backlog),$("#editJob").val(e.jobid),$("#issue_note_edit").val(e.note),$("#taskSummary").text(e.issueSummary),$("#datepickerEditer").datepicker("setDate",e.date);var i=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+n+"]");i.attr("data-weekTimetrackBacklog",e.backlog),i.attr("data-weekTimetrackDuration",e.duration),i.attr("data-weekTimetrackIsRecreditBacklog",e.isRecreditBacklog);i=$("#editWeekTimetrack_dialog");i.find("#backlogChangeInfo").text(""),i.dialog("open")}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}})}),$("#timeToEdit").change(function(){var e=$("#editWeekTimetrack_dialog"),t=e.find("#backlogChangeInfo"),a=e.find("#timetrackId").val(),r=parseFloat(e.find("#timeToEdit").val()),i=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+a+"]"),e=parseFloat(i.attr("data-weekTimetrackDuration")),a=parseFloat(i.attr("data-weekTimetrackBacklog"));"true"===i.attr("data-weekTimetrackIsRecreditBacklog")&&(r!==e?(r=a+e-r,t.text("(Backlog will change to : "+r+")")):t.text(""))}),$("#editWeekTimetrack_dialog").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=$("#issue_note_edit").val(),t=$("#datepickerEditer").val(),a=$("#timeToEdit").val(),r=$("#editJob").val(),i=$("#timetrackId").val();$("#backlogToEdit").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:i,note:e,date:t,duration:a,jobid:r,userid:timetrackingSmartyData.userid,weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(e){var t;"SUCCESS"===e.statusMsg?((t=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+i+"]")).find(".weekTimetrack_duration").text(a),t.find(".weekTimetrack_date").text(e.cosmeticDate),t.find(".weekTimetrack_jobName").text(e.jobName),t.find(".weekTimetrack_ttNote").html(e.ttNote),jQuery("#weekTaskDetailsDiv").html(jQuery.trim(e.timesheetHtml)),updateWidgets("#weekTaskDetailsDiv")):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});