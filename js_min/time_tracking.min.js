function getIssuesAndDurations(e){e.preventDefault();var t=jQuery("#projectid").val(),a=jQuery("#getIssuesAndDurationsForm");a.find("input[name=projectid]").val(t);var s=jQuery("#bugid");s.empty(),s.select2("data",null),s.append(jQuery("<option>").attr("value","0").append(timetrackingSmartyData.i18n_pleaseWait).attr("selected","selected")),jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:a.attr("method"),dataType:"json",data:a.serialize(),success:function(e){s.empty(),s.select2("data",null);var t=e.availableIssues,a=0;for(var r in t)t.hasOwnProperty(r)&&a++;1<a&&s.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"));var i,n="";for(var o in t)t.hasOwnProperty(o)&&(n=null!=(i=t[o]).tcId&&""!=i.tcId?o+" / "+i.tcId+" : "+i.summary:o+" : "+i.summary,s.append(jQuery("<option>").attr("value",o).append(n)));var d=jQuery("#job");d.empty();var u=e.availableJobs,c=0;for(var r in u)u.hasOwnProperty(r)&&c++;for(var o in 1<c&&d.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected")),u)u.hasOwnProperty(o)&&d.append(jQuery("<option>").attr("value",o).append(u[o]));jQuery("#duree").empty();var l=e.availableDurations;for(var o in l)l.hasOwnProperty(o)&&jQuery("#duree").append(jQuery("<option>").attr("value",o).append(l[o]))}})}jQuery(document).ready(function(){"en"!=timetrackingSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate),jQuery("#projectid").change(function(e){getIssuesAndDurations(e)}),jQuery("#filters").click(function(e){e.preventDefault(),jQuery("#setfilter_dialog_form").dialog("open")}),jQuery("#bugid").change(function(){var e;"0"===jQuery("#projectid").val()&&((e=jQuery("#form1")).find("input[name=action]").val("setBugId"),e.find("input[name=weekid]").val(jQuery("#weekid").val()),e.find("input[name=year]").val(jQuery("#year").val()),e.submit())}),jQuery("#btAddTrack").click(function(){var e,t=0,a=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n",r=jQuery("#form1"),i=r.find("select[name=bugid]").val(),n=r.find("select[name=job]").val(),o=r.find("select[name=duree]").val();"0"!==i&&""!==i||(a+=timetrackingSmartyData.i18n_task+"\n",++t),"0"!==n&&""!==n||(a+=timetrackingSmartyData.i18n_job+"\n",++t),"0"!==o&&""!==o||(a+=timetrackingSmartyData.i18n_duration+"\n",++t),0===t?(e=jQuery("#datepicker").val(),getUpdateBacklogData(i,timetrackingSmartyData.userid,n,o,e).done(function(e){"BacklogUpdateNotNeeded"===e.diagnostic?(r.find("input[name=action]").val("addTrack"),r.submit()):"timetrackNoteOnly"===e.diagnostic?(jQuery("#setTimetrackNoteDlg_taskSummary").text(jQuery("#bugid option:selected").text()),jQuery("#setTimetrackNoteDlg_duration").text(jQuery("#duree option:selected").text()),jQuery("#setTimetrackNoteDlg_job").text(jQuery("#job option:selected").text()),jQuery("#setTimetrackNoteDlg_date").text(jQuery("#datepicker").val()),jQuery("#setTimetrackNoteDlg").dialog("open")):(jQuery("#formUpdateBacklog").off("submit"),openUpdateBacklogDialogbox(e))})):alert(a)}),jQuery("#setTimetrackNoteDlg").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:timetrackingSmartyData.i18n_Ok,click:function(){var e=jQuery("#form1"),t=jQuery("#setTimetrackNoteDlg_timetrackNote").val();e.find("input[name=timetrackNote]").val(t),e.find("input[name=action]").val("addTrack"),e.submit()}},{text:timetrackingSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#setfilter_dialog_form").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=jQuery("#formSetFilters");e.find("input[name=projectid]").val(jQuery("#projectid").val()),e.find("input[name=bugid]").val(jQuery("#bugid").val()),e.find("input[name=job]").val(jQuery("#job").val()),e.find("input[name=duree]").val(jQuery("#duree").val()),e.find("input[name=weekid]").val(jQuery("#weekid").val()),e.find("input[name=year]").val(jQuery("#year").val()),e.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var r=jQuery("#formUpdateWeek");jQuery("#form1"),jQuery("#formUpdateBacklog");function i(){r.find("input[name=projectid]").val(jQuery("#projectid").val()),r.find("input[name=bugid]").val(jQuery("#bugid").val()),r.find("input[name=job]").val(jQuery("#job").val()),r.find("input[name=duree]").val(jQuery("#duree").val())}jQuery("#previousweek").click(function(){i();var e,t,a=jQuery("#weekid").val();1!=a?r.find("select[name=weekid]").val(--a):(e=jQuery("#year").val()-1,t=timetrackingSmartyData.nbWeeksPrevYear,r.find("select[name=weekid]").val(t),r.find("select[name=year]").val(e)),r.submit()}),jQuery("#nextweek").click(function(){i();var e,t=jQuery("#weekid").val();parseInt(t)<parseInt(timetrackingSmartyData.nbWeeksThisYear)?r.find("select[name=weekid]").val(++t):(e=+jQuery("#year").val()+1,r.find("select[name=weekid]").val(1),r.find("select[name=year]").val(e)),r.submit()}),jQuery("#weekid, #year").change(function(){i(),r.submit()}),jQuery(".deleteWeekTimetrack_link").click(function(e){e.preventDefault();var t=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getDeleteTimetrackData",timetrackId:t},dataType:"json",success:function(e){"SUCCESS"===e.statusMsg&&(jQuery(".issue_summary").text(e.issueSummary),jQuery("#desc_date").text(e.date),jQuery("#desc_id").text(e.formatedId),jQuery("#desc_duration").text(e.duration),jQuery("#desc_job").text(e.jobName),jQuery("#formDeleteTrack").find("input[name=trackid]").val(t),jQuery("#backlogChangeInfo").text(""),e.isRecreditBacklog&&jQuery("#backlogChangeInfo").text("(Backlog will change to : "+e.futureBacklog+")"))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery("#deleteTrack_dialog_form").dialog("open")}),jQuery("#deleteTrack_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:{Delete:function(){jQuery("#formDeleteTrack").submit()},Cancel:function(){jQuery(this).dialog("close")}}}),jQuery(".editWeekTimetrack_link").click(function(e){e.preventDefault();var o=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getEditTimetrackData",timetrackId:o},dataType:"json",success:function(e){if("SUCCESS"===e.statusMsg){$("#timeToEdit").empty();var t=e.durationsList;for(var a in t)t.hasOwnProperty(a)&&$("#timeToEdit").append($("<option>").attr("value",a).append(t[a]));$("#editJob").empty();var r=e.availableJobs;for(var a in r)r.hasOwnProperty(a)&&$("#editJob").append($("<option>").attr("value",a).append(r[a]));$("#timetrackId").val(o),$("#timeToEdit").val(e.duration),$("#backlogToEdit").val(e.backlog),$("#editJob").val(e.jobid),$("#issue_note_edit").val(e.note),$("#taskSummary").text(e.issueSummary),$("#datepickerEditer").datepicker("setDate",e.date);var i=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+o+"]");i.attr("data-weekTimetrackBacklog",e.backlog),i.attr("data-weekTimetrackDuration",e.duration),i.attr("data-weekTimetrackIsRecreditBacklog",e.isRecreditBacklog);var n=$("#editWeekTimetrack_dialog");n.find("#backlogChangeInfo").text(""),n.dialog("open")}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}})}),$("#timeToEdit").change(function(){var e,t=$("#editWeekTimetrack_dialog"),a=t.find("#backlogChangeInfo"),r=t.find("#timetrackId").val(),i=parseFloat(t.find("#timeToEdit").val()),n=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+r+"]"),o=parseFloat(n.attr("data-weekTimetrackDuration")),d=parseFloat(n.attr("data-weekTimetrackBacklog"));"true"===n.attr("data-weekTimetrackIsRecreditBacklog")&&(i!==o?(e=d+o-i,a.text("(Backlog will change to : "+e+")")):a.text(""))}),$("#editWeekTimetrack_dialog").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=$("#issue_note_edit").val(),t=$("#datepickerEditer").val(),a=$("#timeToEdit").val(),r=$("#editJob").val(),i=$("#timetrackId").val();$("#backlogToEdit").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:i,note:e,date:t,duration:a,jobid:r,userid:timetrackingSmartyData.userid,weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(e){var t;"SUCCESS"===e.statusMsg?((t=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+i+"]")).find(".weekTimetrack_duration").text(a),t.find(".weekTimetrack_date").text(e.cosmeticDate),t.find(".weekTimetrack_jobName").text(e.jobName),t.find(".weekTimetrack_ttNote").html(e.ttNote),jQuery("#weekTaskDetailsDiv").html(jQuery.trim(e.timesheetHtml)),updateWidgets("#weekTaskDetailsDiv")):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});