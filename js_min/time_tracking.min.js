function getIssuesAndDurations(event){event.preventDefault();var bValid=true;if(bValid){var projectid=jQuery("#projectid").val();var formGetIssuesAndDurations=jQuery("#getIssuesAndDurationsForm");formGetIssuesAndDurations.find("input[name=projectid]").val(projectid);var bugidSelect=jQuery("#bugid");bugidSelect.empty();bugidSelect.select2("data",null);bugidSelect.append(jQuery("<option>").attr("value","0").append(timetrackingSmartyData.i18n_pleaseWait).attr("selected","selected"));jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:formGetIssuesAndDurations.attr("method"),dataType:"json",data:formGetIssuesAndDurations.serialize(),success:function(data){bugidSelect.empty();bugidSelect.select2("data",null);var availableIssues=data["availableIssues"];var nbIssues=0;for(var k in availableIssues){if(availableIssues.hasOwnProperty(k)){nbIssues++}}if(nbIssues>1){bugidSelect.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"))}var summary="";var issueInfo;for(var id in availableIssues){if(availableIssues.hasOwnProperty(id)){issueInfo=availableIssues[id];if(null!=issueInfo["tcId"]&&""!=issueInfo["tcId"]){summary=id+" / "+issueInfo["tcId"]+" : "+issueInfo["summary"]}else{summary=id+" : "+issueInfo["summary"]}bugidSelect.append(jQuery("<option>").attr("value",id).append(summary))}}var jobSelect=jQuery("#job");jobSelect.empty();var availableJobs=data["availableJobs"];var nbJobs=0;for(var k in availableJobs){if(availableJobs.hasOwnProperty(k)){nbJobs++}}if(nbJobs>1){jobSelect.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected"))}for(var id in availableJobs){if(availableJobs.hasOwnProperty(id)){jobSelect.append(jQuery("<option>").attr("value",id).append(availableJobs[id]))}}jQuery("#duree").empty();var availableDurationList=data["availableDurations"];for(var id in availableDurationList){if(availableDurationList.hasOwnProperty(id)){jQuery("#duree").append(jQuery("<option>").attr("value",id).append(availableDurationList[id]))}}}})}}function deleteTrack(trackid,date,bugid,duration,job,description){jQuery("#desc_date").text(date);jQuery("#desc_id").text(bugid);jQuery("#desc_duration").text(duration);jQuery("#desc_job").text(job);jQuery("#desc_summary").text(description);jQuery("#formDeleteTrack").find("input[name=trackid]").val(trackid);jQuery("#deleteTrack_dialog_form").dialog("open")}jQuery(document).ready(function(){if(timetrackingSmartyData.datepickerLocale!="en"){jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale])}jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate);jQuery("#projectid").change(function(event){getIssuesAndDurations(event)});jQuery("#filters").click(function(event){event.preventDefault();jQuery("#setfilter_dialog_form").dialog("open")});jQuery("#bugid").change(function(){if("0"===jQuery("#projectid").val()){var form1=jQuery("#form1");form1.find("input[name=action]").val("setBugId");form1.find("input[name=weekid]").val(jQuery("#weekid").val());form1.find("input[name=year]").val(jQuery("#year").val());form1.submit()}});jQuery("#btAddTrack").click(function(){var foundError=0;var msgString=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n";var form1=jQuery("#form1");var bugid=form1.find("select[name=bugid]").val();var jobid=form1.find("select[name=job]").val();var trackDuration=form1.find("select[name=duree]").val();if("0"===bugid){msgString+=timetrackingSmartyData.i18n_task+"\n";++foundError}if("0"===jobid){msgString+=timetrackingSmartyData.i18n_job+"\n";++foundError}if("0"===trackDuration){msgString+=timetrackingSmartyData.i18n_duration+"\n";++foundError}if(0===foundError){var trackDate=jQuery("#datepicker").val();var deferred=getUpdateBacklogData(bugid,timetrackingSmartyData.userid,jobid,trackDuration,trackDate);deferred.done(function(updateBacklogJsonData){if("BacklogUpdateNotNeeded"===updateBacklogJsonData["diagnostic"]){form1.find("input[name=action]").val("addTrack");form1.submit()}else{jQuery("#formUpdateBacklog").off("submit");openUpdateBacklogDialogbox(updateBacklogJsonData)}})}else{alert(msgString)}});jQuery("#setfilter_dialog_form").dialog({autoOpen:false,height:"auto",width:500,modal:true,buttons:{Ok:function(){var form=jQuery("#formSetFilters");form.find("input[name=projectid]").val(jQuery("#projectid").val());form.find("input[name=bugid]").val(jQuery("#bugid").val());form.find("input[name=job]").val(jQuery("#job").val());form.find("input[name=duree]").val(jQuery("#duree").val());form.find("input[name=weekid]").val(jQuery("#weekid").val());form.find("input[name=year]").val(jQuery("#year").val());form.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var formUpdateWeek=jQuery("#formUpdateWeek");function updateFormWeek(){formUpdateWeek.find("input[name=projectid]").val(jQuery("#projectid").val());formUpdateWeek.find("input[name=bugid]").val(jQuery("#bugid").val());formUpdateWeek.find("input[name=job]").val(jQuery("#job").val());formUpdateWeek.find("input[name=duree]").val(jQuery("#duree").val())}jQuery("#previousweek").click(function(){updateFormWeek();var weekid=jQuery("#weekid").val();if(1!=weekid){formUpdateWeek.find("select[name=weekid]").val(--weekid)}else{var year=jQuery("#year").val();var prevYear=year-1;var lastWeekPrevYear=timetrackingSmartyData.nbWeeksPrevYear;formUpdateWeek.find("select[name=weekid]").val(lastWeekPrevYear);formUpdateWeek.find("select[name=year]").val(prevYear)}formUpdateWeek.submit()});jQuery("#nextweek").click(function(){updateFormWeek();var weekid=jQuery("#weekid").val();if(weekid<timetrackingSmartyData.nbWeeksThisYear){formUpdateWeek.find("select[name=weekid]").val(++weekid)}else{formUpdateWeek.find("select[name=weekid]").val(1);var year=jQuery("#year").val();formUpdateWeek.find("select[name=year]").val(++year)}formUpdateWeek.submit()});jQuery("#weekid, #year").change(function(){updateFormWeek();formUpdateWeek.submit()});jQuery("#deleteTrack_dialog_form").dialog({autoOpen:false,resizable:true,width:"auto",modal:true,buttons:{Delete:function(){jQuery("#formDeleteTrack").submit()},Cancel:function(){jQuery(this).dialog("close")}}});jQuery(".editWeekTimetrack_link").click(function(e){e.preventDefault();var timetrackId=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getEditTimetrackData",timetrackId:timetrackId},dataType:"json",success:function(data){if("SUCCESS"===data.statusMsg){$("#timeToEdit").empty();var availableDurationList=data.durationsList;for(var id in availableDurationList){if(availableDurationList.hasOwnProperty(id)){$("#timeToEdit").append($("<option>").attr("value",id).append(availableDurationList[id]))}}$("#editJob").empty();var availableJobs=data.availableJobs;for(var id in availableJobs){if(availableJobs.hasOwnProperty(id)){$("#editJob").append($("<option>").attr("value",id).append(availableJobs[id]))}}$("#timetrackId").val(timetrackId);$("#timeToEdit").val(data.duration);$("#editJob").val(data.jobid);$("#issue_note_edit").val(data.note);$("#taskSummary").text(data.issueSummary);$("#datepickerEditer").datepicker("setDate",data.date);$("#editWeekTimetrack_dialog").dialog("open")}else{console.error("Ajax statusMsg",data.statusMsg);alert(data.statusMsg)}},error:function(jqXHR,textStatus,errorThrown){console.error(textStatus,errorThrown);alert("ERROR: Please contact your CodevTT administrator")}})});$("#editWeekTimetrack_dialog").dialog({autoOpen:false,height:"auto",width:500,modal:true,buttons:{Ok:function(){var note=$("#issue_note_edit").val();var date=$("#datepickerEditer").val();var duration=$("#timeToEdit").val();var jobid=$("#editJob").val();var timetrackId=$("#timetrackId").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:timetrackId,note:note,date:date,duration:duration,jobid:jobid,userid:timetrackingSmartyData.userid,weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(data){if("SUCCESS"===data.statusMsg){var myTr=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+timetrackId+"]");myTr.find(".weekTimetrack_duration").text(duration);myTr.find(".weekTimetrack_date").text(data.cosmeticDate);myTr.find(".weekTimetrack_jobName").text(data.jobName);jQuery("#weekTaskDetailsDiv").html(jQuery.trim(data.timesheetHtml));updateWidgets("#weekTaskDetailsDiv")}else{console.error("Ajax statusMsg",data.statusMsg);alert(data.statusMsg)}},error:function(jqXHR,textStatus,errorThrown){console.error(textStatus,errorThrown);alert("ERROR: Please contact your CodevTT administrator")}});jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});