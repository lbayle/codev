function updateJobList(e){var a=jQuery("#job");a.empty();var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;for(var r in t>1&&a.append(jQuery("<option>").attr("value","0").append("").attr("selected","selected")),e)e.hasOwnProperty(r)&&a.append(jQuery("<option>").attr("value",r).append(e[r]))}function getJobsAndDurations(e){e.preventDefault();jQuery("#loading").show(),jQuery.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"getJobsAndDurations",managedUserid:timetrackingSmartyData.userid,projectid:jQuery("#projectid").val(),bugid:jQuery("#bugid").val()},success:function(e){updateJobList(e.availableJobs),jQuery("#duree").empty();var a=e.availableDurations;for(var t in a)a.hasOwnProperty(t)&&jQuery("#duree").append(jQuery("<option>").attr("value",t).append(a[t]));jQuery("#loading").hide()},error:function(e,a,t){jQuery("#loading").hide(),console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}})}function addTimetrackAndReload(e){var a=jQuery("#form1"),t=jQuery("#bugid").val(),i=a.find("select[name=trackJobid]").val(),r=a.find("select[name=timeToAdd]").val(),n=jQuery("#datepicker").val();jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"addTimetrack",bugid:t,trackDate:n,trackJobid:i,trackUserid:timetrackingSmartyData.userid,timeToAdd:r,issue_note:e},dataType:"json",success:function(e){if("SUCCESS"===e.statusMsg){var a=jQuery("#formReloadTimetrackingPage");a.find("input[name=bugid]").val(t),a.find("input[name=date]").val(n),a.find("input[name=weekid]").val(timetrackingSmartyData.weekid),a.submit()}},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}})}jQuery(document).ready(function(){if("en"!=timetrackingSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[timetrackingSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",timetrackingSmartyData.datepickerDate),jQuery("#projectid").change(function(e){getJobsAndDurations(e)}),jQuery("#bugid").change(function(){"0"===jQuery("#projectid").val()&&getJobsAndDurations(event)}),jQuery("#filters").click(function(e){e.preventDefault(),jQuery("#setfilter_dialog_form").dialog("open")}),jQuery("#bugid").select2({placeholder:timetrackingSmartyData.i18n_TypeToSearch,minimumInputLength:3,width:"resolve",ajax:{type:"POST",url:timetrackingSmartyData.ajaxPage,dataType:"json",delay:500,data:function(e){return{action:"searchIssues",search:e.term,projectId:jQuery("#projectid").val(),managedUserid:timetrackingSmartyData.userid}},processResults:function(e,a){return{results:e}}}}),"0"!==timetrackingSmartyData.defaultBugid){var e=new Option(timetrackingSmartyData.defaultBugText,timetrackingSmartyData.defaultBugid,!0,!0);jQuery("#bugid").append(e)}jQuery("#btAddTrack").click(function(){var e=0,a=timetrackingSmartyData.i18n_someFieldsAreMissing+"\n\n",t=jQuery("#form1"),i=jQuery("#bugid").val(),r=t.find("select[name=trackJobid]").val(),n=t.find("select[name=timeToAdd]").val();if("0"!==i&&""!==i||(a+=timetrackingSmartyData.i18n_task+"\n",++e),"0"!==r&&""!==r||(a+=timetrackingSmartyData.i18n_job+"\n",++e),"0"!==n&&""!==n||(a+=timetrackingSmartyData.i18n_duration+"\n",++e),0===e){var o=jQuery("#datepicker").val();getUpdateBacklogData(i,timetrackingSmartyData.userid,r,n,o).done(function(e){"TimetrackingForbidden"===e.diagnostic?alert(e.reasonWhy):"BacklogUpdateNotNeeded"===e.diagnostic?addTimetrackAndReload(""):"timetrackNoteOnly"===e.diagnostic?(jQuery("#setTimetrackNoteDlg_taskSummary").text(jQuery("#bugid option:selected").text()),jQuery("#setTimetrackNoteDlg_duration").text(jQuery("#duree option:selected").text()),jQuery("#setTimetrackNoteDlg_job").text(jQuery("#job option:selected").text()),jQuery("#setTimetrackNoteDlg_date").text(jQuery("#datepicker").val()),jQuery("#setTimetrackNoteDlg").dialog("open")):(jQuery("#formUpdateBacklog").off("submit"),openUpdateBacklogDialogbox(e))})}else alert(a)}),jQuery("#setTimetrackNoteDlg").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:timetrackingSmartyData.i18n_Ok,click:function(){addTimetrackAndReload(jQuery("#setTimetrackNoteDlg_timetrackNote").val())}},{text:timetrackingSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#setfilter_dialog_form").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=jQuery("#formSetFilters");e.find("input[name=projectid]").val(jQuery("#projectid").val()),e.find("input[name=bugid]").val(jQuery("#bugid").val()),e.find("input[name=job]").val(jQuery("#job").val()),e.find("input[name=duree]").val(jQuery("#duree").val()),e.find("input[name=weekid]").val(jQuery("#weekid").val()),e.find("input[name=year]").val(jQuery("#year").val()),e.submit()},Cancel:function(){jQuery(this).dialog("close")}}});var a=jQuery("#formUpdateWeek");function t(){a.find("input[name=projectid]").val(jQuery("#projectid").val()),a.find("input[name=bugid]").val(jQuery("#bugid").val()),a.find("input[name=job]").val(jQuery("#job").val()),a.find("input[name=duree]").val(jQuery("#duree").val())}jQuery("#previousweek").click(function(){t();var e=jQuery("#weekid").val();if(1!=e)a.find("select[name=weekid]").val(--e);else{var i=+jQuery("#year").val()-1,r=timetrackingSmartyData.nbWeeksPrevYear;a.find("select[name=weekid]").val(r),a.find("select[name=year]").val(i)}var n=jQuery("#datepicker").val();a.find("input[name=date]").val(n),a.submit()}),jQuery("#nextweek").click(function(){t();var e=jQuery("#weekid").val();if(parseInt(e)<parseInt(timetrackingSmartyData.nbWeeksThisYear))a.find("select[name=weekid]").val(++e);else{var i=+jQuery("#year").val()+1;a.find("select[name=weekid]").val(1),a.find("select[name=year]").val(i)}var r=jQuery("#datepicker").val();a.find("input[name=date]").val(r),a.submit()}),jQuery("#weekid, #year").change(function(){t(),a.submit()}),jQuery(".deleteWeekTimetrack_link").click(function(e){e.preventDefault();var a=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getDeleteTimetrackData",timetrackId:a},dataType:"json",success:function(e){"SUCCESS"===e.statusMsg&&(jQuery(".issue_summary").text(e.issueSummary),jQuery("#desc_date").text(e.date),jQuery("#desc_id").text(e.formatedId),jQuery("#desc_duration").text(e.duration),jQuery("#desc_job").text(e.jobName),jQuery("#formDeleteTrack").find("input[name=trackid]").val(a),jQuery("#backlogChangeInfo").text(""),e.isRecreditBacklog&&jQuery("#backlogChangeInfo").text("(Backlog will change to : "+e.futureBacklog+")"))},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery("#deleteTrack_dialog_form").dialog("open")}),jQuery("#deleteTrack_dialog_form").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:timetrackingSmartyData.i18n_Delete,click:function(){var e=$("#formDeleteTrack");$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:e.serialize(),success:function(e){if("SUCCESS"===e.statusMsg){var a=jQuery("#formReloadTimetrackingPage");a.find("input[name=bugid]").val(e.bugid),a.find("input[name=date]").val(e.trackDate),a.submit()}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:timetrackingSmartyData.i18n_Cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery(".editWeekTimetrack_link").click(function(e){e.preventDefault();var a=$(this).parents(".weekTimetrack").attr("data-weekTimetrackId");jQuery.ajax({type:"POST",url:timetrackingSmartyData.ajaxPage,data:{action:"getEditTimetrackData",timetrackId:a},dataType:"json",success:function(e){if("SUCCESS"===e.statusMsg){$("#timeToEdit").empty();var t=e.durationsList;for(var i in t)t.hasOwnProperty(i)&&$("#timeToEdit").append($("<option>").attr("value",i).append(t[i]));$("#editJob").empty();var r=e.availableJobs;for(var i in r)r.hasOwnProperty(i)&&$("#editJob").append($("<option>").attr("value",i).append(r[i]));$("#timetrackId").val(a),$("#timeToEdit").val(e.duration),$("#backlogToEdit").val(e.backlog),$("#editJob").val(e.jobid),$("#issue_note_edit").val(e.note),$("#taskSummary").text(e.issueSummary),$("#datepickerEditer").datepicker("setDate",e.date);var n=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+a+"]");n.attr("data-weekTimetrackBacklog",e.backlog),n.attr("data-weekTimetrackDuration",e.duration),n.attr("data-weekTimetrackIsRecreditBacklog",e.isRecreditBacklog);var o=$("#editWeekTimetrack_dialog");o.find("#backlogChangeInfo").text(""),o.dialog("open")}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}})}),$("#timeToEdit").change(function(){var e=$("#editWeekTimetrack_dialog"),a=e.find("#backlogChangeInfo"),t=e.find("#timetrackId").val(),i=parseFloat(e.find("#timeToEdit").val()),r=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+t+"]"),n=parseFloat(r.attr("data-weekTimetrackDuration")),o=parseFloat(r.attr("data-weekTimetrackBacklog"));if("true"===r.attr("data-weekTimetrackIsRecreditBacklog"))if(i!==n){var d=o+n-i;a.text("(Backlog will change to : "+d+")")}else a.text("")}),$("#editWeekTimetrack_dialog").dialog({autoOpen:!1,height:"auto",width:500,modal:!0,buttons:{Ok:function(){var e=$("#issue_note_edit").val(),a=$("#datepickerEditer").val(),t=$("#timeToEdit").val(),i=$("#editJob").val(),r=$("#timetrackId").val();$("#backlogToEdit").val();$.ajax({url:timetrackingSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"updateTimetrack",timetrackId:r,note:e,date:a,duration:t,jobid:i,userid:timetrackingSmartyData.userid,weekid:timetrackingSmartyData.weekid,year:timetrackingSmartyData.year},success:function(e){if("SUCCESS"===e.statusMsg){var a=$("#weekTimetrackingTuples .weekTimetrack[data-weekTimetrackId^="+r+"]");a.find(".weekTimetrack_duration").text(t),a.find(".weekTimetrack_date").text(e.cosmeticDate),a.find(".weekTimetrack_jobName").text(e.jobName),a.find(".weekTimetrack_ttNote").html(e.ttNote),jQuery("#weekTaskDetailsDiv").html(jQuery.trim(e.timesheetHtml)),updateWidgets("#weekTaskDetailsDiv")}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")},Cancel:function(){jQuery(this).dialog("close")}}})});