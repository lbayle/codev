jQuery.fn.table2CSV=function(options){var options=jQuery.extend({separator:";",header:[],delivery:"file",filename:"output.csv"},options);var csvData=[];var headerArr=[];var el=this;var numCols=options.header.length;var tmpRow=[];if(numCols>0){for(var i=0;i<numCols;i++){tmpRow[tmpRow.length]=formatData(options.header[i])}}else{}row2CSV(tmpRow);$(el).find("tr").each(function(){var tmpRow=[];$(this).find("th, td").each(function(){if($(this).css("display")!="none")tmpRow[tmpRow.length]=formatData($(this).html())});row2CSV(tmpRow)});if(options.delivery=="popup"){var mydata=csvData.join("\n");return popup(mydata)}else if(options.delivery=="file"){var mydata=csvData.join("\n");return saveTextAs(mydata,options.filename)}else{var mydata=csvData.join("\n");return mydata}function row2CSV(tmpRow){var tmp=tmpRow.join("");if(tmpRow.length>0&&tmp!=""){var mystr=tmpRow.join(options.separator);csvData[csvData.length]=mystr}}function formatData(input){var regexp=new RegExp(/["]/g);var output=input.replace(regexp,"â€œ");var regexp=new RegExp(/\<[^\<]+\>/g);var output=output.replace(regexp,"");if(output=="")return"";return'"'+output+'"'}function popup(data){var generator=window.open("","csv","height=400,width=600");generator.document.write("<html><head><title>CSV</title>");generator.document.write("</head><body >");generator.document.write('<textArea cols=70 rows=15 wrap="off" >');generator.document.write(data);generator.document.write("</textArea>");generator.document.write("</body></html>");generator.document.close();return true}function download(filename,content){var pom=document.createElement("a");pom.setAttribute("href","data:attachment/csv,charset=utf-8,"+encodeURIComponent(content));pom.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(content));pom.setAttribute("target","_blank");pom.setAttribute("download",filename);console.log("pom",pom);pom.click()}};
