jQuery(document).ready(function(){"en"!=editTeamSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[editTeamSmartyData.datepickerLocale]);jQuery("#datepicker").datepicker("setDate",editTeamSmartyData.datepickerDate);jQuery("#displayed_teamid").change(function(){jQuery("#displayTeamForm").submit()});var c=jQuery("#updateTeamInfoForm");jQuery("#btupdateTeamCreationDate").click(function(){c.find("input[name=action]").val("updateTeamCreationDate");c.submit()});jQuery("#bt_teamEnabled").click(function(){var b=
jQuery("#cb_teamEnabled").attr("checked")?1:0;c.find("input[name=isTeamEnabled]").val(b);c.find("input[name=action]").val("setTeamEnabled");c.submit()});jQuery("#datepicker1").datepicker("setDate",editTeamSmartyData.datepicker1_arrivalDate);jQuery("#datepicker2").datepicker("setDate",editTeamSmartyData.datepicker2_departureDate);var d=jQuery("#addTeamMemberForm");jQuery("#btAddMember").click(function(){var b=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n";0==d.find("input[name=memberid]").val()&&
(a+=editTeamSmartyData.i18n_teamMember+"\n",++b);0==b?(d.find("input[name=action]").val("addTeamMember"),d.submit()):alert(a)});jQuery("#btAddMembersFrom").click(function(){var b=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n";0==d.find("input[name=f_src_teamid]").val()&&(a+=editTeamSmartyData.i18n_sourceTeam+"\n",++b);0==b?(d.find("input[name=action]").val("addMembersFrom"),d.submit()):alert(a)});jQuery("#btAddProject").click(function(){var b=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+
"\n\n",c=jQuery("#addTeamProjectForm");0==c.find("input[name=addedprojectid]").val()&&(a+=editTeamSmartyData.i18n_project+"\n",++b);0==b?c.submit():alert(a)});jQuery("#btSetGeneralPrefs").click(function(){var b=jQuery("#generalPrefsForm"),a="";jQuery(".generalPrefsItem").each(function(){var b=jQuery(this).attr("name"),c=jQuery(this).attr("checked")?1:0;a+=b+":"+c+","});b.find("input[name=checkItems]").val(a);b.submit()});jQuery("#btSetConsistencyChecks").click(function(){var b=jQuery("#consistencyCheckForm"),
a="";jQuery(".consistencyCheckItem").each(function(){var b=jQuery(this).attr("name"),c=jQuery(this).attr("checked")?1:0;a+=b+":"+c+","});b.find("input[name=checkItems]").val(a);b.submit()});jQuery("#btAddAstreinte").click(function(){var b=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n",c=jQuery("#addAstreinteForm");0==c.find("input[name=addedastreinte_id]").val()&&(a+=editTeamSmartyData.i18n_inactivityTask+"\n",++b);0==b?c.submit():alert(a)});jQuery("#tableTeamAdmin").on("click",".bt_addTeamAdmin",
function(b){b=jQuery("#cb_TeamAdminCandidates").val();0!=b&&jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"addTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:b},type:"post",success:function(a){a=JSON.parse(a);if("SUCCESS"!==a.statusMsg)console.error(a.statusMsg),jQuery(".addTeamAdminErrorMsg").html(a.statusMsg);else{var b=jQuery('<a align="absmiddle" >').addClass("bt_deleteTeamAdmin ui-icon pointer");jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(b),
jQuery("<td>").text(a.adminName)).attr("data-adminId",a.adminId).addClass("teamAdminRow").appendTo("#tableTeamAdmin tbody");$("#cb_TeamAdminCandidates option[value='"+a.adminId+"']").remove();$("#cb_TeamAdminCandidates").select2("val","");jQuery(".addTeamAdminErrorMsg").html("");jQuery(".missingTeamAdminRow").remove()}},error:function(a,b,c){console.error("ERROR addTeamAdmin errorThrown",c);jQuery(".addTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})});jQuery("#tableTeamAdmin").on("click",
".bt_deleteTeamAdmin",function(b){b=jQuery(this).closest("tr.teamAdminRow").attr("data-adminId");jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"deleteTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:b},type:"post",success:function(a){a=JSON.parse(a);"SUCCESS"!==a.statusMsg?(console.error(a.statusMsg),jQuery(".deleteTeamAdminErrorMsg").html(a.statusMsg)):(jQuery(".teamAdminRow[data-adminId='"+a.adminId+"']").remove(),a={id:a.adminId,text:a.adminName},a=new Option(a.text,
a.id,!1,!1),$("#cb_TeamAdminCandidates").append(a).trigger("change"),jQuery(".deleteTeamAdminErrorMsg").html(""))},error:function(a,b,c){console.error("ERROR deleteTeamAdmin errorThrown",c);jQuery(".deleteTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})});jQuery("#deleteDuration_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:editTeamSmartyData.i18n_delete,click:function(){jQuery("#formDeleteDuration").submit()}},{text:editTeamSmartyData.i18n_cancel,
click:function(){jQuery(this).dialog("close")}}]});jQuery("#udrUserid").change(function(){updateAddUdrDlg_userArrivalDate()});jQuery(".btAddUserDailyCost").click(function(){jQuery(".addUdrErrorMsg").html("");updateAddUdrDlg_userArrivalDate();jQuery(".dialogAddUserDailyCost").dialog("open")});jQuery(".dialogAddUserDailyCost").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,create:function(){$(this).closest(".ui-dialog").find(".ui-button:first").addClass("btAddUserDailyCost")},buttons:[{text:editTeamSmartyData.i18n_add,
click:function(){var b=$("#formAddUserDailyCost");jQuery(".addUdrErrorMsg").html("");$.ajax({url:editTeamSmartyData.ajaxPage,type:b.attr("method"),dataType:"json",data:b.serialize(),success:function(a){if(null===a)jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator");else if("SUCCESS"!==a.statusMsg)jQuery(".addUdrErrorMsg").html(a.statusMsg);else{var b=jQuery('<a align="absmiddle" >').addClass("bt_deleteUDC ui-icon pointer");jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(b),
jQuery("<td>").text(a.udrStruct.userName),jQuery("<td>").text(a.udrStruct.startDate),jQuery("<td>").text(a.udrStruct.udr+" "+a.udrStruct.currency),jQuery("<td>").text(a.udrStruct.description)).attr("data-udrId",a.udrStruct.id).addClass("udrRow").prependTo("#tableUserDailyCosts tbody");jQuery(".addUdrErrorMsg").html("");jQuery(".dialogAddUserDailyCost").dialog("close")}},error:function(a,b,c){console.error("ERROR AddUserDailyCost errorThrown",c);jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}},
{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(".addDashboardErrorMsg").html("");jQuery(this).dialog("close")}}]});jQuery("#tableUserDailyCosts").on("click",".bt_deleteUDC",function(b){b=jQuery(this).closest("tr.udrRow").attr("data-udrId");jQuery(".deleteUdrErrorMsg").html("");jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"deleteUDC",displayed_teamid:editTeamSmartyData.displayedTeamId,udrId:b},type:"post",success:function(a){a=JSON.parse(a);"SUCCESS"!==a.statusMsg?
(console.log(a.statusMsg),jQuery(".deleteUdrErrorMsg").html("ERROR: Failed to remove UDC")):jQuery(".udrRow[data-udrId='"+a.udrId+"']").remove()},error:function(a,b,c){console.error("ERROR AddUserDailyCost errorThrown",c);jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})});jQuery("#btUpdateTeamADR").click(function(){var b=$("#formTeamADR");jQuery(".updateTeamAdrInfoMsg").html("");jQuery(".updateTeamAdrErrorMsg").html("");$.ajax({url:editTeamSmartyData.ajaxPage,
type:b.attr("method"),dataType:"json",data:b.serialize(),success:function(a){null===a?jQuery(".updateTeamAdrErrorMsg").html("ERROR: Please contact your CodevTT administrator"):"SUCCESS"!==a.statusMsg?jQuery(".updateTeamAdrErrorMsg").html(a.statusMsg):(jQuery(".updateTeamAdrInfoMsg").html(editTeamSmartyData.i18n_updatedSuccessfully),$(".displayedTeamCurrency").html(a.teamCurrency))},error:function(a){console.error("ERROR data = ",a);jQuery(".updateTeamAdrErrorMsg").html("UpdateTeamADR ERROR!")}})});
jQuery(".teamAdrHelpDialog_link").click(function(b){b.preventDefault();jQuery(".teamAdrHelpDialog").dialog("open")});jQuery(".teamAdrHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"});jQuery(".currencyHelpDialog_link").click(function(b){b.preventDefault();jQuery(".currencyHelpDialog").dialog("open")});jQuery(".currencyHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"});jQuery(".removeTeamMember_link").click(function(b){b.preventDefault();var a=$(this).parents(".teamMembers_tr");
b=$(a).attr("data-rowId");a=$(a).children(".teamMember_realname").text();confirm(editTeamSmartyData.i18n_removeUserFromThisTeam+"\n\n"+a)&&$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"removeTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,removeMemberRowId:b},success:function(a){null===a?(console.error("ERROR removeTeamMember: no data"),alert("ERROR: Please contact your CodevTT administrator")):"SUCCESS"!==a.statusMsg?(console.error("ERROR Ajax statusMsg",
a.statusMsg),alert(a.statusMsg)):jQuery(".teamMembers_tr[data-rowId='"+a.rowId+"']").remove()},error:function(a,b,c){console.error("ERROR removeTeamMember errorThrown",c)}})});jQuery(".editTeamMember_link").click(function(b){b.preventDefault();var a=$(this).parents(".teamMembers_tr");b=$(a).attr("data-teamMemberId");var c=$(a).children(".teamMember_realname").text(),d=$(a).children(".teamMember_arrivalDate").text(),e=$(a).children(".teamMember_departureDate").text();a=$(a).children(".teamMember_role").attr("data-roleId");
console.log(b,c,d,e,a);jQuery("#editTeamMember_dialog").dialog("option","title",c);jQuery("#editTeamMemberDlg_userId").text(b);jQuery("#editTeamMemberDlg_arrivalDate").datepicker("setDate",d);jQuery("#editTeamMemberDlg_departureDate").datepicker("setDate",e);jQuery("#editTeamMemberDlg_select_role").val(a);jQuery("#editTeamMember_dialog").dialog("open")});jQuery("#editTeamMember_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,
click:function(){$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"editTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,userId:$("#editTeamMemberDlg_userId").text(),arrivalDate:$("#editTeamMemberDlg_arrivalDate").val(),departureDate:$("#editTeamMemberDlg_departureDate").val(),accessLevelId:$("#editTeamMemberDlg_select_role option:selected").val()},success:function(b){if("SUCCESS"===b.statusMsg){var a=$(".teamMembers_tr[data-teamMemberId="+b.userId+"]");
a.find(".teamMember_arrivalDate").html(b.arrivalDate);a.find(".teamMember_departureDate").html(b.departureDate);a.find(".teamMember_role").html(b.accessLevel);a.find(".teamMember_role").attr("data-roleId",b.accessLevelId)}else console.error("Ajax statusMsg",b.statusMsg),alert(b.statusMsg)},error:function(b,a,c){console.error(a,c);alert("ERROR: Please contact your CodevTT administrator")}});jQuery(this).dialog("close")}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]});
jQuery(".editPrjJobAssociation_link").click(function(b){b.preventDefault();var a=$(this).parents(".projectList_tr");b=$(a).attr("data-projectId");a=$(a).attr("data-projectName");$("#editPrjJobAssoDlg_tbl tbody").empty();jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"getPrjJobAsso",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:b},type:"post",success:function(a){a=JSON.parse(a);"SUCCESS"!==a.statusMsg?console.log(a.statusMsg):jQuery.each(a.jobList,function(a,b){var c=
jQuery('<input type="checkbox">').addClass("opt_enabled");c.attr("checked",b.checked);jQuery("<tr>").addClass("editPrjJobAssoDlg_tr").attr("data-jobId",b.id).append(jQuery("<td>").addClass("right").append(c),jQuery("<td>").addClass("left").addClass("opt_jobName").attr("title",b.id).text(b.name)).appendTo("#editPrjJobAssoDlg_tbl tbody")})},error:function(a,b,c){console.error("ERROR getPrjJobAsso errorThrown",c)}});jQuery("#editPrjJobAsso_dialog").dialog("option","title",editTeamSmartyData.i18n_jobListForProject+
a);jQuery("#editPrjJobAssoDlg_tbl").attr("data-projectId",b);jQuery("#editPrjJobAsso_dialog").dialog("open")});jQuery("#editPrjJobAsso_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,click:function(){var b={};$("#editPrjJobAssoDlg_tbl .editPrjJobAssoDlg_tr").each(function(){var a=$(this).attr("data-jobId"),c=$(this).find(".opt_enabled").attr("checked")?1:0;b[a]=c});$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",
data:{action:"savePrjJobAsso",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:$("#editPrjJobAssoDlg_tbl").attr("data-projectId"),jobListStr:JSON.stringify(b)},success:function(a){"SUCCESS"===a.statusMsg?$(".projectList_tr[data-projectId="+a.projectId+"]").find(".projectJobsList").text(a.jobNameListStr):(console.error("Ajax statusMsg",a.statusMsg),alert(a.statusMsg))},error:function(a,b,c){console.error(b,c);alert("ERROR: Please contact your CodevTT administrator")}});jQuery(this).dialog("close")}},
{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]})});
function updateAddUdrDlg_userArrivalDate(){jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"getUserArrivalDate",displayed_teamid:editTeamSmartyData.displayedTeamId,udrUserid:jQuery("#udrUserid").val()},type:"post",success:function(c){c=JSON.parse(c);"SUCCESS"!==c.statusMsg?(console.error(c.statusMsg),jQuery("#addUdrDlg_userArrivalDate").html("ERROR")):jQuery("#addUdrDlg_userArrivalDate").html(c.arrivalDate)},error:function(c,d,b){console.error("ERROR getUserArrivalDate errorThrown",b);jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}
function removeTeamProject(c,d){if(confirm(editTeamSmartyData.i18n_removeThisProjectFromTheTeam+"\n\n"+d)){var b=jQuery("#removeTeamProjectForm");b.find("input[name=deletedprojectid]").val(c);b.submit()}}
function itemSelection_ok_callback(c){c=jQuery.parseJSON(c);var d=c.projectid;if(jQuery("#issueTooltips_proj_"+c.projectid).length)jQuery("#issueTooltips_proj_"+d+"_fields").text(c.tooltipFields);else{jQuery("#issueTooltipsTable").attr("style","");jQuery("#noCustomTooltipsInfo").attr("style","display:none");jQuery("#issueTooltipsTable").append(jQuery("<tr>").attr("id","issueTooltips_proj_"+d));var b=jQuery("<a>").attr("class","ui-icon").attr("href",editTeamSmartyData.page).attr("onclick","removeIssueTooltip('"+
d+"','"+c.projectName+"');return false;");jQuery("#issueTooltips_proj_"+d).append(jQuery("<td>").attr("class","ui-state-error-text").attr("style","width:1em;").append(b)).append(jQuery("<td>").text(c.projectName)).append(jQuery("<td>").attr("id","issueTooltips_proj_"+d+"_fields").text(c.tooltipFields))}}
function removeIssueTooltip(c,d){if(confirm(editTeamSmartyData.i18n_removeIssueTooltipCustomisationForProject+" "+d)){var b=jQuery("#removeIssueTooltipForm");b.find("input[name=projectid]").val(c);b.submit()}}function deleteOnDutyTask(c,d){if(confirm(editTeamSmartyData.i18n_noLongerOnDuty+"\n"+d)){var b=jQuery("#deleteAstreinteForm");b.find("input[name=deletedastreinte_id]").val(c);b.submit()}}
function deleteDuration(c,d){jQuery("#dur_value").text(c);jQuery("#dur_display").text(d);jQuery("#formDeleteDuration").find("input[name=deleteValue]").val(c);jQuery("#formDeleteDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);jQuery("#deleteDuration_dialog_form").dialog("open")}
function addDuration(){jQuery("#formAddDuration").find("input[name=addValue]").val(document.getElementById("addValue").value);jQuery("#formAddDuration").find("input[name=addDisplay]").val(document.getElementById("addDisplay").value);jQuery("#formAddDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);var c=validateAdd();0==c.length?jQuery("#formAddDuration").submit():alert(c)}
function editDuration(c){var d=c.innerHTML;c.onclick=void 0;var b=c.id.replace("display","");c.innerHTML="<input type='text' value='"+d+"' style='background-color:#F3F781;' id='editDisplay"+b+"' /><a class='ui-icon' title='"+editTeamSmartyData.i18n_save+"' href='"+editTeamSmartyData.page+"' style='background:url(images/b_markAsRead.png);' onclick='updateDuration("+b+");return false;'></a>"}
function updateDuration(c){jQuery("#formUpdateDuration").find("input[name=updateValue]").val(c);jQuery("#formUpdateDuration").find("input[name=updateDisplay]").val(document.getElementById("editDisplay"+c).value);jQuery("#formUpdateDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);c=validateUpdate();0==c.length?jQuery("#formUpdateDuration").submit():alert(c)}
function validateAdd(){var c="";var d=document.forms.formAddDuration.addValue.value;var b=document.forms.formAddDuration.addDisplay.value;d=d.replace(/\s+/g,"");b=b.replace(/\s+/g,"");if(0==d.length)c+="\n Value must be filled out.";else if(isNaN(d))c+="\n Value must be numeric.";else if(d=parseFloat(d),0>d||1<d)c+="\n Value must be between 0 and 1.";0==b.length&&(c+="\n Display must be filled out.");return c}
function validateUpdate(){var c="";var d=document.forms.formUpdateDuration.updateDisplay.value;d=d.replace(/\s+/g,"");0==d.length&&(c+="\n Display must be filled out");return c};