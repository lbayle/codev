function updateAddUdrDlg_userArrivalDate(){jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"getUserArrivalDate",displayed_teamid:editTeamSmartyData.displayedTeamId,udrUserid:jQuery("#udrUserid").val()},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.error(e.statusMsg),jQuery("#addUdrDlg_userArrivalDate").html("ERROR")):jQuery("#addUdrDlg_userArrivalDate").html(e.arrivalDate)},error:function(e,t,a){console.error("ERROR getUserArrivalDate errorThrown",a),jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}function removeTeamProject(e,t){var a,r=editTeamSmartyData.i18n_removeThisProjectFromTheTeam+"\n\n"+t;confirm(r)&&((a=jQuery("#removeTeamProjectForm")).find("input[name=deletedprojectid]").val(e),a.submit())}function itemSelection_ok_callback(e){var t,a=jQuery.parseJSON(e),r=a.projectid;jQuery("#issueTooltips_proj_"+a.projectid).length?jQuery("#issueTooltips_proj_"+r+"_fields").text(a.tooltipFields):(jQuery("#issueTooltipsTable").attr("style",""),jQuery("#noCustomTooltipsInfo").attr("style","display:none"),jQuery("#issueTooltipsTable").append(jQuery("<tr>").attr("id","issueTooltips_proj_"+r)),t=jQuery("<a>").attr("class","ui-icon").attr("href",editTeamSmartyData.page).attr("onclick","removeIssueTooltip('"+r+"','"+a.projectName+"');return false;"),jQuery("#issueTooltips_proj_"+r).append(jQuery("<td>").attr("class","ui-state-error-text").attr("style","width:1em;").append(t)).append(jQuery("<td>").text(a.projectName)).append(jQuery("<td>").attr("id","issueTooltips_proj_"+r+"_fields").text(a.tooltipFields)))}function removeIssueTooltip(e,t){var a,r=editTeamSmartyData.i18n_removeIssueTooltipCustomisationForProject+" "+t;confirm(r)&&((a=jQuery("#removeIssueTooltipForm")).find("input[name=projectid]").val(e),a.submit())}function deleteOnDutyTask(e,t){var a,r=editTeamSmartyData.i18n_noLongerOnDuty+"\n"+t;confirm(r)&&((a=jQuery("#deleteAstreinteForm")).find("input[name=deletedastreinte_id]").val(e),a.submit())}function deleteDuration(e,t){jQuery("#dur_value").text(e),jQuery("#dur_display").text(t),jQuery("#formDeleteDuration").find("input[name=deleteValue]").val(e),jQuery("#formDeleteDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value),jQuery("#deleteDuration_dialog_form").dialog("open")}function addDuration(){jQuery("#formAddDuration").find("input[name=addValue]").val(document.getElementById("addValue").value),jQuery("#formAddDuration").find("input[name=addDisplay]").val(document.getElementById("addDisplay").value),jQuery("#formAddDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);var e=validateAdd();0==e.length?jQuery("#formAddDuration").submit():alert(e)}function editDuration(e){var t=e.innerHTML;e.onclick=void 0;var a=e.id.replace("display","");e.innerHTML="<input type='text' value='"+t+"' style='background-color:#F3F781;' id='editDisplay"+a+"' /><a class='ui-icon' title='"+editTeamSmartyData.i18n_save+"' href='"+editTeamSmartyData.page+"' style='background:url(images/b_markAsRead.png);' onclick='updateDuration("+a+");return false;'></a>"}function updateDuration(e){jQuery("#formUpdateDuration").find("input[name=updateValue]").val(e),jQuery("#formUpdateDuration").find("input[name=updateDisplay]").val(document.getElementById("editDisplay"+e).value),jQuery("#formUpdateDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);var t=validateUpdate();0==t.length?jQuery("#formUpdateDuration").submit():alert(t)}function validateAdd(){var e="",t="",a="",e=document.forms.formAddDuration.addValue.value,t=document.forms.formAddDuration.addDisplay.value;return e=e.replace(/\s+/g,""),t=t.replace(/\s+/g,""),0==e.length?a+="\n Value must be filled out.":isNaN(e)?a+="\n Value must be numeric.":((e=parseFloat(e))<0||1<e)&&(a+="\n Value must be between 0 and 1."),0==t.length&&(a+="\n Display must be filled out."),a}function validateUpdate(){var e="";return 0==document.forms.formUpdateDuration.updateDisplay.value.replace(/\s+/g,"").length&&(e+="\n Display must be filled out"),e}jQuery(document).ready(function(){"en"!=editTeamSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[editTeamSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",editTeamSmartyData.datepickerDate),jQuery("#displayed_teamid").change(function(){jQuery("#displayTeamForm").submit()}),jQuery("#datepicker1").datepicker("setDate",editTeamSmartyData.datepicker1_arrivalDate),jQuery("#datepicker2").datepicker("setDate",editTeamSmartyData.datepicker2_departureDate);var a=jQuery("#addTeamMemberForm");jQuery("#btAddMember").click(function(){var e=0,t=editTeamSmartyData.i18n_someFieldsAreMissing+"\n";0==a.find("input[name=memberid]").val()&&(t+=editTeamSmartyData.i18n_teamMember+"\n",++e),0==e?(a.find("input[name=action]").val("addTeamMember"),a.submit()):alert(t)}),jQuery("#btAddMembersFrom").click(function(){var e=0,t=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n";0==a.find("input[name=f_src_teamid]").val()&&(t+=editTeamSmartyData.i18n_sourceTeam+"\n",++e),0==e?(a.find("input[name=action]").val("addMembersFrom"),a.submit()):alert(t)}),jQuery("#btAddProject").click(function(){var e=0,t=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n",a=jQuery("#addTeamProjectForm");0==a.find("input[name=addedprojectid]").val()&&(t+=editTeamSmartyData.i18n_project+"\n",++e),0==e?a.submit():alert(t)}),jQuery("#btSetGeneralPrefs").click(function(){var e=jQuery("#generalPrefsForm"),a="";jQuery(".generalPrefsItem").each(function(){var e=jQuery(this).attr("name"),t=jQuery(this).attr("checked")?1:0;a+=e+":"+t+","}),e.find("input[name=checkItems]").val(a),e.submit()}),jQuery("#btSetConsistencyChecks").click(function(){var e=jQuery("#consistencyCheckForm"),a="";jQuery(".consistencyCheckItem").each(function(){var e=jQuery(this).attr("name"),t=jQuery(this).attr("checked")?1:0;a+=e+":"+t+","}),e.find("input[name=checkItems]").val(a),e.submit()}),jQuery("#btAddAstreinte").click(function(){var e=0,t=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n",a=jQuery("#addAstreinteForm");0==a.find("input[name=addedastreinte_id]").val()&&(t+=editTeamSmartyData.i18n_inactivityTask+"\n",++e),0==e?a.submit():alert(t)}),jQuery("#tableTeamAdmin").on("click",".bt_addTeamAdmin",function(e){var t=jQuery("#cb_TeamAdminCandidates").val();0!=t&&jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"addTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:t},type:"post",success:function(e){var t;"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.error(e.statusMsg),jQuery(".addTeamAdminErrorMsg").html(e.statusMsg)):(t=jQuery('<a align="absmiddle" >').addClass("bt_deleteTeamAdmin ui-icon pointer"),jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(t),jQuery("<td>").text(e.adminName)).attr("data-adminId",e.adminId).addClass("teamAdminRow").appendTo("#tableTeamAdmin tbody"),$("#cb_TeamAdminCandidates option[value='"+e.adminId+"']").remove(),$("#cb_TeamAdminCandidates").select2("val",""),jQuery(".addTeamAdminErrorMsg").html(""),jQuery(".missingTeamAdminRow").remove())},error:function(e,t,a){console.error("ERROR addTeamAdmin errorThrown",a),jQuery(".addTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#tableTeamAdmin").on("click",".bt_deleteTeamAdmin",function(e){var t=jQuery(this).closest("tr.teamAdminRow").attr("data-adminId");jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"deleteTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:t},type:"post",success:function(e){var t;"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.error(e.statusMsg),jQuery(".deleteTeamAdminErrorMsg").html(e.statusMsg)):(jQuery(".teamAdminRow[data-adminId='"+e.adminId+"']").remove(),e={id:e.adminId,text:e.adminName},t=new Option(e.text,e.id,!1,!1),$("#cb_TeamAdminCandidates").append(t).trigger("change"),jQuery(".deleteTeamAdminErrorMsg").html(""))},error:function(e,t,a){console.error("ERROR deleteTeamAdmin errorThrown",a),jQuery(".deleteTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#deleteDuration_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:editTeamSmartyData.i18n_delete,click:function(){jQuery("#formDeleteDuration").submit()}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#udrUserid").change(function(){updateAddUdrDlg_userArrivalDate()}),jQuery(".btAddUserDailyCost").click(function(){jQuery(".addUdrErrorMsg").html(""),updateAddUdrDlg_userArrivalDate(),jQuery(".dialogAddUserDailyCost").dialog("open")}),jQuery(".dialogAddUserDailyCost").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,create:function(){$(this).closest(".ui-dialog").find(".ui-button:first").addClass("btAddUserDailyCost")},buttons:[{text:editTeamSmartyData.i18n_add,click:function(){var e=$("#formAddUserDailyCost");jQuery(".addUdrErrorMsg").html(""),$.ajax({url:editTeamSmartyData.ajaxPage,type:e.attr("method"),dataType:"json",data:e.serialize(),success:function(e){var t;null===e?jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator"):"SUCCESS"!==e.statusMsg?jQuery(".addUdrErrorMsg").html(e.statusMsg):(t=jQuery('<a align="absmiddle" >').addClass("bt_deleteUDC ui-icon pointer"),jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(t),jQuery("<td>").text(e.udrStruct.userName),jQuery("<td>").text(e.udrStruct.startDate),jQuery("<td>").text(e.udrStruct.udr+" "+e.udrStruct.currency),jQuery("<td>").text(e.udrStruct.description)).attr("data-udrId",e.udrStruct.id).addClass("udrRow").prependTo("#tableUserDailyCosts tbody"),jQuery(".addUdrErrorMsg").html(""),jQuery(".dialogAddUserDailyCost").dialog("close"))},error:function(e,t,a){console.error("ERROR AddUserDailyCost errorThrown",a),jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(".addDashboardErrorMsg").html(""),jQuery(this).dialog("close")}}]}),jQuery("#tableUserDailyCosts").on("click",".bt_deleteUDC",function(e){var t=jQuery(this).closest("tr.udrRow").attr("data-udrId");jQuery(".deleteUdrErrorMsg").html(""),jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"deleteUDC",displayed_teamid:editTeamSmartyData.displayedTeamId,udrId:t},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.log(e.statusMsg),jQuery(".deleteUdrErrorMsg").html("ERROR: Failed to remove UDC")):jQuery(".udrRow[data-udrId='"+e.udrId+"']").remove()},error:function(e,t,a){console.error("ERROR AddUserDailyCost errorThrown",a),jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#btUpdateTeamADR").click(function(){var e=$("#formTeamADR");jQuery(".updateTeamAdrInfoMsg").html(""),jQuery(".updateTeamAdrErrorMsg").html(""),$.ajax({url:editTeamSmartyData.ajaxPage,type:e.attr("method"),dataType:"json",data:e.serialize(),success:function(e){null===e?jQuery(".updateTeamAdrErrorMsg").html("ERROR: Please contact your CodevTT administrator"):"SUCCESS"!==e.statusMsg?jQuery(".updateTeamAdrErrorMsg").html(e.statusMsg):(jQuery(".updateTeamAdrInfoMsg").html(editTeamSmartyData.i18n_updatedSuccessfully),$(".displayedTeamCurrency").html(e.teamCurrency))},error:function(e){console.error("ERROR data = ",e),jQuery(".updateTeamAdrErrorMsg").html("UpdateTeamADR ERROR!")}})}),jQuery(".teamAdrHelpDialog_link").click(function(e){e.preventDefault(),jQuery(".teamAdrHelpDialog").dialog("open")}),jQuery(".teamAdrHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"}),jQuery(".currencyHelpDialog_link").click(function(e){e.preventDefault(),jQuery(".currencyHelpDialog").dialog("open")}),jQuery(".currencyHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"}),jQuery(".removeTeamMember_link").click(function(e){e.preventDefault();var t=$(this).parents(".teamMembers_tr"),a=$(t).attr("data-rowId"),r=$(t).children(".teamMember_realname").text(),d=editTeamSmartyData.i18n_removeUserFromThisTeam+"\n\n"+r;confirm(d)&&$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"removeTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,removeMemberRowId:a},success:function(e){null===e?(console.error("ERROR removeTeamMember: no data"),alert("ERROR: Please contact your CodevTT administrator")):"SUCCESS"!==e.statusMsg?(console.error("ERROR Ajax statusMsg",e.statusMsg),alert(e.statusMsg)):jQuery(".teamMembers_tr[data-rowId='"+e.rowId+"']").remove()},error:function(e,t,a){console.error("ERROR removeTeamMember errorThrown",a)}})}),jQuery(".editTeamMember_link").click(function(e){e.preventDefault();var t=$(this).parents(".teamMembers_tr"),a=$(t).attr("data-teamMemberId"),r=$(t).children(".teamMember_realname").text(),d=$(t).children(".teamMember_arrivalDate").text(),i=$(t).children(".teamMember_departureDate").text(),o=$(t).children(".teamMember_role").attr("data-roleId");console.log(a,r,d,i,o),jQuery("#editTeamMember_dialog").dialog("option","title",r),jQuery("#editTeamMemberDlg_userId").text(a),jQuery("#editTeamMemberDlg_arrivalDate").datepicker("setDate",d),jQuery("#editTeamMemberDlg_departureDate").datepicker("setDate",i),jQuery("#editTeamMemberDlg_select_role").val(o),jQuery("#editTeamMember_dialog").dialog("open")}),jQuery("#editTeamMember_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,click:function(){$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"editTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,userId:$("#editTeamMemberDlg_userId").text(),arrivalDate:$("#editTeamMemberDlg_arrivalDate").val(),departureDate:$("#editTeamMemberDlg_departureDate").val(),accessLevelId:$("#editTeamMemberDlg_select_role option:selected").val()},success:function(e){var t;"SUCCESS"===e.statusMsg?((t=$(".teamMembers_tr[data-teamMemberId="+e.userId+"]")).find(".teamMember_arrivalDate").html(e.arrivalDate),t.find(".teamMember_departureDate").html(e.departureDate),t.find(".teamMember_role").html(e.accessLevel),t.find(".teamMember_role").attr("data-roleId",e.accessLevelId)):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery(".editPrjJobAssociation_link").click(function(e){e.preventDefault();var t=$(this).parents(".projectList_tr"),a=$(t).attr("data-projectId"),r=$(t).attr("data-projectName");$("#editPrjJobAssoDlg_tbl tbody").empty(),jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"getPrjJobAsso",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:a},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?console.log(e.statusMsg):jQuery.each(e.jobList,function(e,t){var a=jQuery('<input type="checkbox">').addClass("opt_enabled");a.attr("checked",t.checked),jQuery("<tr>").addClass("editPrjJobAssoDlg_tr").attr("data-jobId",t.id).append(jQuery("<td>").addClass("right").append(a),jQuery("<td>").addClass("left").addClass("opt_jobName").attr("title",t.id).text(t.name)).appendTo("#editPrjJobAssoDlg_tbl tbody")})},error:function(e,t,a){console.error("ERROR getPrjJobAsso errorThrown",a)}}),jQuery("#editPrjJobAsso_dialog").dialog("option","title",editTeamSmartyData.i18n_jobListForProject+r),jQuery("#editPrjJobAssoDlg_tbl").attr("data-projectId",a),jQuery("#editPrjJobAsso_dialog").dialog("open")}),jQuery("#editPrjJobAsso_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,click:function(){var a={};$("#editPrjJobAssoDlg_tbl .editPrjJobAssoDlg_tr").each(function(){var e=$(this).attr("data-jobId"),t=$(this).find(".opt_enabled").attr("checked")?1:0;a[e]=t}),$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"savePrjJobAsso",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:$("#editPrjJobAssoDlg_tbl").attr("data-projectId"),jobListStr:JSON.stringify(a)},success:function(e){"SUCCESS"===e.statusMsg?$(".projectList_tr[data-projectId="+e.projectId+"]").find(".projectJobsList").text(e.jobNameListStr):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#btUpdateTeamInfo").click(function(){var e=$("#updateTeamInfoForm");jQuery(".updateTeamInfoMsg").html(""),jQuery(".updateTeamErrorMsg").html("");var t=jQuery("#cb_teamEnabled").attr("checked")?1:0;e.find("input[name=isTeamEnabled]").val(t),$.ajax({url:editTeamSmartyData.ajaxPage,type:e.attr("method"),dataType:"json",data:e.serialize(),success:function(e){null===e?jQuery(".updateTeamErrorMsg").html("ERROR: Please contact your CodevTT administrator"):"SUCCESS"!==e.statusMsg?(console.error(e.statusMsg),jQuery(".updateTeamErrorMsg").html(e.statusMsg)):jQuery(".updateTeamInfoMsg").html("SUCCESS !")},error:function(e){console.error("ERROR data = ",e),jQuery(".updateTeamErrorMsg").html("UpdateTeamInfo ERROR!")}})}),jQuery(".editForbidenStatusList_link").click(function(e){e.preventDefault();var t=$(this).parents(".projectList_tr"),a=$(t).attr("data-projectId"),r=$(t).attr("data-projectName");$("#editForbidenStatusListDlg_tbl tbody").empty(),jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"getForbidenStatusList",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:a},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?console.log(e.statusMsg):jQuery.each(e.prjStatusList,function(e,t){var a=jQuery('<input type="checkbox">').addClass("opt_enabled");a.attr("checked",t.checked),a.prop("disabled",t.disabled);var r=jQuery("<span>").text(t.name);t.disabled&&r.addClass("help_font"),jQuery("<tr>").addClass("editForbidenStatusListDlg_tr").attr("data-statusId",t.id).append(jQuery("<td>").addClass("right").append(a),jQuery("<td>").addClass("left").addClass("opt_prjStatusName").attr("title",t.id).append(r)).appendTo("#editForbidenStatusListDlg_tbl tbody")})},error:function(e,t,a){console.error("ERROR getForbidenStatusList errorThrown",a)}}),jQuery("#editForbidenStatusList_dialog").dialog("option","title",editTeamSmartyData.i18n_forbidenStatusListForProject+r),jQuery("#editForbidenStatusListDlg_tbl").attr("data-projectId",a),jQuery("#editForbidenStatusList_dialog").dialog("open")}),jQuery("#editForbidenStatusList_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,click:function(){var a={};$("#editForbidenStatusListDlg_tbl .editForbidenStatusListDlg_tr").each(function(){var e=$(this).attr("data-statusId"),t=$(this).find(".opt_enabled").attr("checked")?1:0;a[e]=t}),$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"saveForbidenStatusList",displayed_teamid:editTeamSmartyData.displayedTeamId,projectId:$("#editForbidenStatusListDlg_tbl").attr("data-projectId"),prjStatusListStr:JSON.stringify(a)},success:function(e){"SUCCESS"===e.statusMsg?$(".projectList_tr[data-projectId="+e.projectId+"]").find(".projectStatusList").text(e.prjStatusNameListStr):(console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg))},error:function(e,t,a){console.error(t,a),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]})});